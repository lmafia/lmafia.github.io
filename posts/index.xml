<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Posts on KyleGeeks</title>
    <link>https://blog.kylegeeks.com/posts/</link>
    <description>Recent content in Posts on KyleGeeks</description>
    <image>
      <url>https://blog.kylegeeks.com/images/kyle-avatar.jpg</url>
      <link>https://blog.kylegeeks.com/images/kyle-avatar.jpg</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Sun, 18 Jan 2026 00:00:00 +0800</lastBuildDate><atom:link href="https://blog.kylegeeks.com/posts/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>代码变廉价了，但软件没有</title>
      <link>https://blog.kylegeeks.com/posts/2026/01/code-is-cheap-now-software-isnt/</link>
      <pubDate>Sun, 18 Jan 2026 00:00:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2026/01/code-is-cheap-now-software-isnt/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;原文作者: &lt;a href=&#34;https://www.chrisgregori.dev/&#34;&gt;Chris Gregori&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;原文链接: &lt;a href=&#34;https://www.chrisgregori.dev/opinion/code-is-cheap-now-software-isnt&#34;&gt;Code Is Cheap Now. Software Isn’t.&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;构建软件的&lt;strong&gt;准入门槛&lt;/strong&gt;已经崩塌。但构建&lt;strong&gt;真正有价值的东西&lt;/strong&gt;的门槛，却从未降低分毫。&lt;/p&gt;
&lt;p&gt;Claude Code 和 Claude Opus 4.5 为这场 AI 热潮火上浇油。虽然 LLM（大语言模型）工具早已有之，但现在的它们比以往任何时候都更强大，因此吸引了更多人的目光。但我们并没有进入 SaaS 的黄金时代。我们正在进入一个&lt;strong&gt;个人化、一次性软件&lt;/strong&gt;的时代——在这个时代，工程学的重心从“编写代码”转移到了“塑造系统”，而这也正是工程师依然无可替代的原因。&lt;/p&gt;</description>
      <content:encoded><![CDATA[<blockquote>
<p>原文作者: <a href="https://www.chrisgregori.dev/">Chris Gregori</a></p>
<p>原文链接: <a href="https://www.chrisgregori.dev/opinion/code-is-cheap-now-software-isnt">Code Is Cheap Now. Software Isn’t.</a></p>
</blockquote>
<p>构建软件的<strong>准入门槛</strong>已经崩塌。但构建<strong>真正有价值的东西</strong>的门槛，却从未降低分毫。</p>
<p>Claude Code 和 Claude Opus 4.5 为这场 AI 热潮火上浇油。虽然 LLM（大语言模型）工具早已有之，但现在的它们比以往任何时候都更强大，因此吸引了更多人的目光。但我们并没有进入 SaaS 的黄金时代。我们正在进入一个<strong>个人化、一次性软件</strong>的时代——在这个时代，工程学的重心从“编写代码”转移到了“塑造系统”，而这也正是工程师依然无可替代的原因。</p>
<h4 id="现代开发的转变">现代开发的转变</h4>
<p>Claude Code 现在占据了我的信息流，这并非没有理由。有趣的不只是开发者们正在蜂拥而至，而是那些以前依赖 Lovable 或 Replit 等平台的“构建者”和创客们也正在迁移过来。</p>
<p>别误会，这些工具对于快速发布产品来说仍然非常出色。但我们看到通过 CLI（命令行界面）互动的范式转变，揭示了一种被重新发现的美感：<strong>CLI 优先的工作流</strong>。当你将交互转移到终端时，抽象层变薄了。你不再只是沿着管理界面设计好的“快乐路径”走，而是<strong>你</strong>在掌控一切。</p>
<h4 id="准入门槛的崩塌">准入门槛的崩塌</h4>
<p>人们实际上在用这些工具构建什么？如果你环顾四周，答案是：<strong>几乎所有东西</strong>。事实上，我们已经达到了一个饱和点。一方面，我们见证了软件创造的真正民主化。准入门槛实际上已经崩塌。第一次，非开发者不仅仅是软件的消费者——他们成为了自己工具的架构师。</p>
<p>在过去，如果你有一个特定的问题，你会花几个小时寻找一个能解决 80% 问题的 SaaS 产品。今天，工作流已经转变。人们打开命令行或语音接口，简单描述他们需要的。我们看到了“个人软件”的激增：</p>
<ul>
<li>一个为特定预算风格量身定制的订阅追踪器</li>
<li>一个解决非常利基的数据录入问题的 Chrome 扩展</li>
<li>一个界面完全符合用户心意的健身应用</li>
</ul>
<p>这是一个巨大的转变。软件正在变成你<strong>生成</strong>的个人效用工具，而不是你<strong>购买</strong>的商品。</p>
<h4 id="从-saas-到草稿本">从 SaaS 到“草稿本”</h4>
<p>我们正在进入软件开发的新时代，在这个时代，目标并不总是“长久”。多年来，行业一直痴迷于构建“平台”和“生态系统”，但潮流正在转向更短暂的东西。我们正在从 SaaS 转向<strong>草稿本 (Scratchpads)</strong>。</p>
<p>许多这种新软件并不是为了永生。事实上，恰恰相反。人们越来越多地构建工具来解决<strong>单一、具体的问题</strong>，而且只用一次——然后就丢弃它们。这是作为一次性效用工具的软件，是为紧迫的“现在”而设计，而不是为遥远的“未来”。</p>
<p>让这一切在今天变得可行的，是一种特定的技术哲学：<strong>CLI 优先的接口、本地数据和零上手成本</strong>。当你消除了注册、配置数据库或浏览复杂 UI 的摩擦时，创建一个工具的成本降得如此之低，以至于“临时性”成了一种特性，而不是 Bug。如果花五分钟就能为一个一次性任务启动一个定制解决方案，你就不需要它持久存在。</p>
<p>这与传统的 SaaS 模式形成了鲜明对比。SaaS 本质上是为了优化<strong>留存、锁定和扩展</strong>而构建的。它是一种商业模式，旨在将你留在生态系统中并扩大你的足迹。另一方面，定制工具优化的是<strong>即时性和控制权</strong>。它们不关心你作为客户的终身价值 (LTV)；它们只关心解决手头的任务。</p>
<p>在许多方面，这是回归了电子表格最初的用法。你打开电子表格不是为了建立一个永久的、多年的数据库；你用它作为草稿本来理清问题、计算结果，然后继续前进。</p>
<p>在这个新格局中，Claude Code 是开发者的 Excel——一个解决即时问题的强大、灵活的实用工具——而不是创始人的 Shopify，后者是为了成为企业的永久基石而构建的。它的核心在于<strong>搞定工作，然后放手</strong>。</p>
<p>这也解释了为什么下一部分很重要：<strong>快速生成软件是一回事；让它在现实世界的碰撞中存活下来是另一回事。</strong></p>
<h4 id="代码是廉价的软件依然昂贵">代码是廉价的。软件依然昂贵。</h4>
<p>这就是当前“AI 原生”时代的残酷现实：<strong>代码变得廉价了，但软件依然极其昂贵。</strong></p>
<p>LLM 有效地消灭了生成代码行的成本，但它们丝毫没有触及<strong>真正理解一个问题</strong>的成本。我们看到大量“周末构建的 App”泛滥，但其中大多数只是围绕基本 CRUD 操作和第三方 API 的薄壳。它们在 Twitter 演示中看起来令人印象深刻，但一旦遇到现实世界的摩擦，它们往往瞬间崩溃。</p>
<p>软件的真正成本不是最初的编写；而是<strong>维护、边缘情况、日益增加的 UX 债务以及数据所有权的复杂性</strong>。这些“快速”解决方案是脆弱的。当银行更改其 CSV 导出格式时，订阅追踪器就会崩溃。当目标网站的 DOM 变动时，Chrome 扩展就会失效。一旦用户需要强大的离线支持或可靠的数据同步，健身应用就变得无法使用。</p>
<p>最近，我在 Hacker News、Reddit 和 Twitter 上看到了大量关于“软件工程终结”的末日言论。这完全没抓到重点。我们并没有见证这个职业的终结；我们正在进入它的一个<strong>新时代</strong>。</p>
<p>工程师的价值正在从语法的“如何做 (How)”转移到系统的“是什么 (What)”和“为什么 (Why)”。真正的工程在于<strong>抽象和架构</strong>。它是关于知道如何构建一个持久的系统，理解为什么需要特定的限流策略，知道如何管理分布式缓存，以及清楚地知道在哪里<strong>不该</strong>存储你的环境变量。</p>
<p>AI 往往让人感觉强大，因为它<strong>隐藏</strong>了复杂性，但作为一名工程师，你的工作是<strong>管理</strong>这种复杂性，而不是忽视它。工具变了，但对<strong>工程严谨性</strong>的根本要求从未像现在这样高。</p>
<h4 id="流量的假象-the-distribution-illusion">流量的假象 (The Distribution Illusion)</h4>
<p>但这也有其另一面。随着准入门槛的消失，噪音水平达到了历史最高点。我的信息流目前充斥着“AI 创业者”，声称他们在一个下午构建的 App 获得了五位数的月经常性收入 (MRR)。</p>
<p>在许多情况下，这些说法非常可疑。当你看到一个没有任何现有分发渠道、没有明显“护城河”的创作者声称一个周末项目获得了 10,000 美元的 MRR 时，这通常是为了<strong>博取流量 (Engagement)</strong>，而不是商业现实的反映。其中一些故事几乎可以肯定是真实的，但在大多数情况下，这些并不是技术创新的蓝图。它们是<strong>营销案例研究</strong>。这些人之所以成功，是因为他们掌握了在拥挤的景观中<strong>捕捉注意力</strong>的艺术，而不仅仅是因为他们有一个 AI 副驾驶。</p>
<p>我们已经进入了一个时代，<strong>生成代码的能力不再是瓶颈</strong>。<strong>真正的挑战已经转移到了分发</strong>，更重要的是，从行业中如此普遍的“快速致富”姿态中<strong>甄别出真正的效用</strong>。</p>
<p>这些人并没有偶然发现什么秘密捷径；他们只是找到了一种方法来更快地执行他们原本就拥有的优势（如果学习编码对于一个副业想法来说曾经是一个太过巨大的工程，那么现在他们可能确实解锁了这种能力）。</p>
<p>对于这种转变，有一个有用的框架：<strong>AI 实际上已经消除了作为主要差异化因素的“工程杠杆”。</strong> 当任何开发者都可以使用 LLM 在以前所需时间的一小部分内构建和部署复杂功能时，编写代码的能力不再是曾经的竞争优势。仅仅做一个“构建者 (Builder)”已经不够了。</p>
<p>相反，成功现在取决于那些<strong>更难自动化</strong>的因素。<strong>品味 (Taste)、时机 (Timing) 以及对受众深刻、直观的理解</strong>比以往任何时候都更重要。你可以在一个周末生成一个产品，但如果你构建的是错误的东西，或者把它发布给一屋子根本不听的人，那是毫无价值的。</p>
<p>在这个新环境中，代码变成了容易的部分。困难的部分依然是它一直以来的样子：<strong>找到一种方法让人们在乎。</strong></p>
<h4 id="谁是赢家">谁是赢家</h4>
<p>首先，是那些被枯燥、重复性问题困扰的<strong>领域专家</strong>。
其次，是构建<strong>一次性工具</strong>的内部团队，那些需要立即工作而不需要看起来完美的脚本和内部应用。
<strong>高级用户 (Power Users)</strong> 在这里也看到了巨大的收益，特别是当他们希望用更健壮的东西替换脆弱的手动工作流时。
最后，这是那些把**“解决方案的所有权”**置于“高光打磨”之上的工程师的胜利。</p>
<p>是的——像 Claude Opus 4.5、Claude Code 和 Cursor 这样的工具对工程师来说确实很有用。它们在消除样板代码、实现功能和编写单元测试方面表现出色。最近我最喜欢的一个用例（特别是因为我刚开始一份新工作），是<strong>生成个性化的文档和功能演练</strong>，以便快速熟悉产品代码库和所有细节是如何运作的——这对于快速上手非常有帮助。</p>
<p>但现实是：<strong>LLM 在编写代码方面并不完美</strong>——即使它第一次就能编译通过。即使有高质量的提示词和明确的规则，这些模型仍然会犯错。作为一个每天使用这些工具的人，我可以告诉你：<strong>你不能简单地完全信任输出。</strong> 你仍然必须像审查队友的 Pull Request 一样审查代码。你必须阅读逻辑，检查假设，并经常进行手动编辑以使其正确。</p>
<p>毕竟，你很可能会把这个发给队友进行审查（或者可能是 Code Rabbit，我猜）——让他们审查你没写甚至没费心检查的东西，这公平吗？这些工具通过帮助你走得更快，但它们<strong>并不能取代批判性眼光或你多年的经验</strong>，它们也不比你更了解整体的问题空间。</p>
<p>炒作让它看起来像我们正在进入 SaaS 的黄金时代。<strong>我们没有。</strong>
我们正在进入<strong>个人软件</strong>的时代：你生成工具来解决问题，然后继续前进。</p>
<p>哪怕只有二十美元、几个小时的空闲时间和一点耐心，几乎任何人都可以发布一个功能性的应用程序。我们正在进入“个人软件”时代，从最初的想法到工作产品的差距从未如此之窄。</p>
<p>在这个新现实中，<strong>工程专业知识依然极其宝贵</strong>，但角色的性质正在转变。相关性并没有消退。相反，它是关于利用这些工具在比以前更高的层次上进行构建。现在需要<strong>真正的专业知识</strong>来驾驭这些系统，并提供 LLM 目前缺乏的技术监督。</p>
<p>虽然 AI 在编写代码方面无可否认地擅长，但在<strong>架构可维护、可分发和可扩展的系统</strong>方面仍然很差。这就是那些认为可以解雇开发团队的非技术领导者犯下重大错误的地方。除非如果我们看到一种能让整个讨论变得毫无意义的人工智能出现，否则相信技术专业知识可以被提示词取代是一个战略错误。<strong>构建健壮的软件仍然需要一个理解手艺底层原则的人类。</strong></p>
<p>归根结底，虽然工具变了，但<strong>优秀工程的基础没有变</strong>。
虽然准入门槛可能已经消失——但<strong>判断力、品味和责任感</strong>依然是这份工作的核心。</p>]]></content:encoded>
    </item>
    
    <item>
      <title>如何在一天内彻底改变你的生活</title>
      <link>https://blog.kylegeeks.com/posts/2026/01/how-to-fix-your-entire-life-in-1-day/</link>
      <pubDate>Sun, 18 Jan 2026 00:00:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2026/01/how-to-fix-your-entire-life-in-1-day/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;原文作者: &lt;a href=&#34;https://x.com/thedankoe&#34;&gt;Dan Koe&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;原文链接: &lt;a href=&#34;https://x.com/thedankoe/article/2010751592346030461&#34;&gt;How to fix your entire life in 1 day&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;如果你和我一样，大概也会觉得“新年决心”这种东西很蠢。&lt;/p&gt;
&lt;p&gt;因为大多数人改变生活的方式完全错了。他们制定这些决心往往是因为“大家都在这么做”——我们为了某种虚荣的地位游戏，赋予了它一层肤浅的意义——但这些决心并不符合&lt;strong&gt;真正改变&lt;/strong&gt;的要求。真正的蜕变，远比说服自己“今年要更自律”或“更高效”要深刻得多。&lt;/p&gt;
&lt;p&gt;如果你也是这群人中的一员，我并没有贬低你的意思（虽然我的行文风格通常比较犀利）。我曾放弃过的目标，大概是我实现过的目标的十倍之多。我认为这对大多数人来说都是常态。但无可否认的事实是：人们试图改变生活，却几乎每次都以彻底失败告终。&lt;/p&gt;
&lt;p&gt;然而，尽管我认为“新年决心”很蠢，但&lt;strong&gt;反思你所厌恶的生活，并以此为跳板迈向更好的生活&lt;/strong&gt;，永远是明智之举。这正是我们接下来要探讨的。&lt;/p&gt;
&lt;p&gt;因此，无论你是想创业、重塑身材，还是想冒险去过上一种更有意义的生活（而不是坚持两周就放弃），我都想分享7个你可能从未听说过的理念。这些理念涵盖&lt;strong&gt;行为改变、心理学和生产力&lt;/strong&gt;，它们将助你在2026年真正实现目标。&lt;/p&gt;
&lt;p&gt;这是一篇干货满满的长文。
它不是那种你读完随手就忘的快餐读物。
这是一篇值得你收藏、从头到尾做笔记，并专门留出时间深入思考的文章。
文末附带的“行动协议”&lt;strong&gt;（旨在深入挖掘你的潜意识，揭示你生命中真正渴望的东西）大约需要花费&lt;/strong&gt;一整天的时间来完成，但它带来的影响将深远得多。&lt;/p&gt;
&lt;p&gt;让我们开始吧。&lt;/p&gt;</description>
      <content:encoded><![CDATA[<blockquote>
<p>原文作者: <a href="https://x.com/thedankoe">Dan Koe</a></p>
<p>原文链接: <a href="https://x.com/thedankoe/article/2010751592346030461">How to fix your entire life in 1 day</a></p>
</blockquote>
<p>如果你和我一样，大概也会觉得“新年决心”这种东西很蠢。</p>
<p>因为大多数人改变生活的方式完全错了。他们制定这些决心往往是因为“大家都在这么做”——我们为了某种虚荣的地位游戏，赋予了它一层肤浅的意义——但这些决心并不符合<strong>真正改变</strong>的要求。真正的蜕变，远比说服自己“今年要更自律”或“更高效”要深刻得多。</p>
<p>如果你也是这群人中的一员，我并没有贬低你的意思（虽然我的行文风格通常比较犀利）。我曾放弃过的目标，大概是我实现过的目标的十倍之多。我认为这对大多数人来说都是常态。但无可否认的事实是：人们试图改变生活，却几乎每次都以彻底失败告终。</p>
<p>然而，尽管我认为“新年决心”很蠢，但<strong>反思你所厌恶的生活，并以此为跳板迈向更好的生活</strong>，永远是明智之举。这正是我们接下来要探讨的。</p>
<p>因此，无论你是想创业、重塑身材，还是想冒险去过上一种更有意义的生活（而不是坚持两周就放弃），我都想分享7个你可能从未听说过的理念。这些理念涵盖<strong>行为改变、心理学和生产力</strong>，它们将助你在2026年真正实现目标。</p>
<p>这是一篇干货满满的长文。
它不是那种你读完随手就忘的快餐读物。
这是一篇值得你收藏、从头到尾做笔记，并专门留出时间深入思考的文章。
文末附带的“行动协议”<strong>（旨在深入挖掘你的潜意识，揭示你生命中真正渴望的东西）大约需要花费</strong>一整天的时间来完成，但它带来的影响将深远得多。</p>
<p>让我们开始吧。</p>
<h2 id="i--你之所以没能到达你想去的地方是因为你还未成为配得上那里的人">I – 你之所以没能到达你想去的地方，是因为你还未成为“配得上那里”的人</h2>
<p>在设定宏大目标时，人们往往只关注成功的两个要素之一：</p>
<ol>
<li><strong>改变你的行动</strong>，以便在目标上取得进展。（次要的，二阶改变）</li>
<li><strong>改变“你是谁”</strong>，让你的行为自然而然地发生。（最重要的，一阶改变）</li>
</ol>
<p>大多数人设定的都只是表层目标。他们给自己打满鸡血，试图在最初几周保持“自律”，然后毫不费力地被打回原形。这是因为他们试图在一个早已腐朽的地基上建造梦想的大厦。</p>
<p>如果这听起来有点抽象，让我们来看个例子。
想象一个成功人士。可以是一位拥有完美体格的健美运动员，一位身价数亿的创始人/CEO，或者一个充满魅力、能毫无焦虑地在人群中侃侃而谈的人。</p>
<p>你认为那位健美运动员需要“咬牙坚持”才能吃得健康吗？那位 CEO 需要强迫自己“自律”地去领导团队吗？在你看来，表面上或许如此，但真相是：<strong>他们无法想象自己过着除此之外的任何生活。</strong> 对健美运动员来说，吃<strong>不健康</strong>的食物才需要“咬牙坚持”。对 CEO 来说，如果闹钟响后还要赖床，他们必须强迫自己才能做到，而且他们会讨厌那其中的每一秒（当然这里有细微差别，请先听我把话说完）。</p>
<p>对某些人来说，我自己的生活方式似乎有些极端和过于自律。但对我而言，这再自然不过了。我这么说并不是为了通过对比来贬低其他生活方式。我只是单纯享受这样生活。当我妈妈劝我应该休息一下、出去玩玩、找点乐子时……我常常忍住没反驳她：“如果我不享受其中，如果不觉得好玩，我为什么还要做我现在做的事？”</p>
<p>下一句话听起来很简单，但令人费解的是，竟然有那么多人不明白这一点：
<strong>如果你想要生活中的某个特定结果，你必须在该结果出现很久之前，就已经拥有了能够“创造该结果”的生活方式。</strong></p>
<p>如果有人说他们想减掉 30 磅，我通常是不信的。不是我不认为他们有能力，而是有太多次听到同一个人说：“我迫不及待地想减完肥，这样我就能重新开始享受生活了。”
我很遗憾地告诉你：如果你不能<strong>终生</strong>采纳那种让你成功减肥的生活方式，并且找到一个比“把你束缚在旧习惯上”引力更大的理由，那么你注定会直接回到原点。届时，你只能痛苦地承认，你浪费了永远无法挽回的资源：时间。</p>
<p>当你从本质上改变了自己，那些无法推动你实现目标的旧习惯就会变得令你作呕，因为你已经深刻而透彻地意识到，这些行为会累积成什么样平庸的生活。你现在之所以对目前的标准感到满意，是因为你没有完全意识到它们究竟是什么，或者它们最终会将你引向何方。我们将讨论如何揭示这一点，但在此之前，我们需要先做些铺垫。</p>
<p>你说你想改变。你说你想“实现财务自由”和“变得健康”，但你的行动却背道而驰。这是有原因的。而且这背后的原因，比你想象的要深刻得多。</p>
<h2 id="ii--你之所以没能到达你想去的地方是因为你根本不想去那里">II – 你之所以没能到达你想去的地方，是因为你根本“不想”去那里</h2>
<blockquote>
<p>“只相信行动。生活发生在事件的层面，而不是语言的层面。相信行动。”
– 阿尔弗雷德·阿德勒 (Alfred Adler)</p>
</blockquote>
<p>如果你想改变“你是谁”，你必须了解心智是如何运作的，这样才能开始对他进行“重编程”。
理解心智的第一步是明白：<strong>所有行为都是目标导向的</strong>。也就是所谓的“目的论”（Teleological）。仔细想想，这似乎显而易见，但当我们深入挖掘时，大多数人却往往掩耳盗铃。</p>
<p>你向前迈一步，是因为你想到达某个位置。
你抓挠鼻子，是因为你想止痒。</p>
<p>这些显而易见。但大多数时候，你的目标是<strong>无意识</strong>的。例如，当你在中午瘫坐在沙发上刷手机时，你可能没有意识到，你的潜意识目标其实是“消磨时间，直到下一个必须履行的责任到来”。</p>
<p>在更深层、更复杂的潜意识层面，你甚至会追求那些<strong>伤害你自己</strong>的目标，但你会用一种社会可接受的方式为你的行为辩护，以免自己看起来像个失败者。</p>
<p>举个例子，如果你无法停止拖延工作，你可能会用“我缺乏自律”来自我辩解。但实际上，正如其他所有行为一样，你正在试图实现一个目标。在这种情况下，那个隐秘的目标可能是：<strong>保护自己免受“完成工作并发布”后可能面临的评判。</strong></p>
<p>如果你说你想辞掉那份没前途的工作，却迟迟没有动静，也许你会开始自我怀疑：“我没有足够的勇气”或者“我天生就不是冒险的料”。但真相是，你正在追求<strong>安全感、可预测性</strong>，并试图维持一个借口，以免在那些认为“拥有一份稳定工作就是成功”的亲友眼中显得像个失败者。</p>
<p>这里的核心教训是：<strong>真正的改变，始于改变你的目标设定。</strong>
我指的不是设定一些表面的新年愿望，因为设定愿望这个行为本身，往往就服务于一个正在伤害你的无意识目标（比如获得短暂的心理慰藉）。这在生产力领域已经被讲烂了。
我指的是<strong>改变你的视角</strong>。因为这才是目标的本质。目标是对未来的投射，它充当了感知的透镜，使你能够捕捉到那些有助于你实现该目标的信息、想法和资源。</p>
<p>现在让我们挖掘得更深一点。因为如果你不理解这一点，只会更难跳出泥潭。</p>
<h2 id="iii--你之所以没能到达你想去的地方是因为你害怕去那里">III – 你之所以没能到达你想去的地方，是因为你害怕去那里</h2>
<blockquote>
<p>“对你来说，重要的是要记住：你是如何得到这个想法的，或者它来自哪里，一点也不重要。你可能从未见过专业的催眠师，也从未被正式催眠过。但是，如果你接受了一个想法——无论它来自你自己、你的老师、父母、朋友、广告，还是任何其他来源——而且，如果你坚信那个想法是真的，那么它对你拥有的力量，就和催眠师的指令对被催眠者的力量一样强大。”
– 麦克斯韦·马尔茨 (Maxwell Maltz, 《心理控制论》作者)</p>
</blockquote>
<p>这就是你如何成为今天的你，以及你将如何成为明天的你的过程。这就是<strong>身份的解剖学</strong>：</p>
<ol>
<li>你想实现一个目标。</li>
<li>你通过那个目标的透镜来感知现实。</li>
<li>你只注意到那些允许你实现该目标的“重要”信息和想法（<strong>学习</strong>）。</li>
<li>你朝着那个目标行动，并收到“你正在朝着它前进”的反馈。</li>
<li>你重复那种行为，直到它变得自动和无意识（<strong>调节/Conditioning</strong>）。</li>
<li>那种行为内化为你认为“你是谁”的一部分（“<strong>我就是那种……的人</strong>”）。</li>
<li>你本能地捍卫这种身份，以保持心理的一致性。</li>
<li>你的身份塑造了新的目标，循环重新开始。如果那个身份不利于美好的生活，情况会迅速恶化。</li>
</ol>
<p>残酷的现实是，你必须打破第 6 步和第 7 步之间的循环，但这个循环从你还是个孩子的时候就开始建立了。
那时的你，首要目标是生存。
你依赖父母教你如何生存。你必须顺从。因为大多数教育方式是基于“奖励和惩罚”的，除非你全盘接受他们的信念和价值观，否则你就会受到惩罚。在你看透这个游戏之前，你其实并没有在<strong>为自己</strong>思考。</p>
<p>更危险的是，你的父母在他们的一生中也经历了同样的循坏。除非他们自己打破了这种模式，否则他们也被工业时代文化所普遍接受的“成功观念”所束缚。他们承载着来自他们父母、以及祖辈的最好和最坏的制约。</p>
<p>再深入一层，一旦你满足了生理生存需求（在当今世界这很容易做到，你几乎生来就是安全的），你就会开始在<strong>概念</strong>或<strong>意识形态</strong>层面寻求生存。你或许不再需要拼命保护身体，但你会拼命保护和繁衍你的<strong>思想</strong>。看看互联网上的思想战争就知道了，参与其中的战士，正是无数个体的“身份认同”。</p>
<p>当你的身体感到受威胁时，你会进入“战斗或逃跑”模式。
当你的身份感到受威胁时，同样的生理反应也会发生。
如果你严重认同某种政治意识形态（通过我们刚才讨论的过程），当有人挑战你的信仰时，你会感到切实地受到威胁。你能感觉到压力的袭来。在情感上，这感觉就像被人狠狠扇了一巴掌。由于大多数人不习惯分析情绪背后的真相，你往往会躲回回声室（Echo Chambers），并在那些伤害自己和他人的主张上加倍下注。</p>
<p>如果你在一个宗教家庭长大，并且从未独立思考过，你会本能地攻击那些威胁戳破你心理安全气泡的人。
同样，当你无意识地将自己定义为一个“律师”、一个“游戏玩家”或者其他任何<strong>不会采取行动去实现更美好生活</strong>的人时，同样的防御机制也会启动。</p>
<h2 id="iv--你想要的生活存在于更高层级的心智中">IV – 你想要的生活，存在于更高层级的心智中</h2>
<p>心智的进化遵循着可预测的阶段。
当你刚出生时，你就像一块求生海绵，为了获得安全感，你全盘吸收周围环境（很大程度上由你的文化决定）灌输给你的任何信念。如果你不小心，你的心智可能会固化在某个早期阶段，这会使过上有意义的生活变得异常困难。</p>
<p>这在马斯洛需求层次、格鲁特的自我发展阶段（Ego Development）、螺旋动力学（Spiral Dynamics）和整合理论（Integral Theory）等模型中已经有详尽的记录。每一个理论都建立在另一个之上，但这在社会观察中其实并不难发现。</p>
<p>以下是自我发展 9 个阶段的“80/20 法则”精简版（因为重复有助于揭示你之前视而不见的东西）：</p>
<ol>
<li><strong>冲动型 (Impulsive)</strong> —— 冲动和行动之间没有界限。思维非黑即白。例如：蹒跚学步的孩子因为生气而打人，因为对他来说，感受和行为就是同一回事。</li>
<li><strong>自我保护型 (Self-Protective)</strong> —— 世界是危险的，你学会了自保。例如：孩子学会藏成绩单，在做家务上撒谎，并学会揣摩成年人想听什么话。</li>
<li><strong>墨守成规型 (Conformist)</strong> —— 你就是你的群体，群体的规则就是现实本身。例如：某人真心无法理解为什么会有人投出与他们家族或圈子不同的选票。</li>
<li><strong>自我觉知型 (Self-Aware)</strong> —— 你开始注意到你有一个与外在表现不匹配的内心世界。例如：坐在教堂里，意识到你不确定自己是否相信周围人似乎都深信不疑的东西，但还不知道该如何处理这种脱节感。</li>
<li><strong>尽责型 (Conscientious)</strong> —— 你建立了自己的原则体系，并以此自我约束。例如：经过深思熟虑后离开家庭信仰，采纳一套你能逻辑自洽的个人哲学；或者制定具有明确里程碑的职业规划，因为你相信“正确的努力带来正确的结果”。</li>
<li><strong>个人主义型 (Individualist)</strong> —— 你看到你的原则其实也是由环境塑造的，并开始更灵活地看待它们。例如：意识到你的政治立场更多与你的成长环境有关，而非绝对真理；或者注意到你雄心勃勃的职业目标，其实是为了获得父亲的认可。</li>
<li><strong>策略型 (Strategist)</strong> —— 你能够利用系统，同时清楚自己也身在其中。例如：在领导一个组织时，积极质疑自己的盲点；或者参与政治，但深知自己的观点是局部的，并受制于自己无法完全看见的偏见。</li>
<li><strong>构建觉知型 (Construct-Aware)</strong> —— 你将所有框架，包括你的“身份”，都视为有用的<strong>虚构</strong>。例如：以隐喻而非字面意义持有精神信仰；知道“地图不等于领土”；或者带着一种温和的娱乐心态，看着自己扮演“创始人”或“思想领袖”的角色。</li>
<li><strong>统一型 (Unitive)</strong> —— “自我”与“生活”之间的界限消融。例如：工作、休息和娱乐浑然一体。没有人在试图“成为”什么，只有纯粹的觉知在对当下的发生做出反应。</li>
</ol>
<p>对于正在阅读本文的大多数人，我假设你在 <strong>4 到 8</strong> 之间徘徊，这是一个巨大的跨度。那些接近第 8 阶段的人阅读本文，主要是为了查漏补缺或作为一种健康的消遣。而那些接近第 4 阶段的人，是<strong>真的在寻求改变</strong>。你感觉自己注定不凡，但又无法理清头绪，因为显然有太多的因素在相互作用。</p>
<p>好消息是：无论你处于哪个阶段都不重要，因为穿越这些阶段的过程，都遵循着同样的模式。</p>
<h2 id="v--智力就是从生活中得到你想要的东西的能力">V – 智力，就是“从生活中得到你想要的东西”的能力</h2>
<blockquote>
<p>“检验智力的唯一真正标准，是你是否从生活中得到了你想要的东西。”
– Naval Ravikant</p>
</blockquote>
<p>成功有一个公式，由三个成分组成：</p>
<ol>
<li><strong>能动性 (Agency)</strong></li>
<li><strong>机会 (Opportunity)</strong></li>
<li><strong>智力 (Intelligence)</strong></li>
</ol>
<p>如果你有很高的能动性但机会寥寥，那么无论你多么努力朝着目标行动，结果都不重要，因为那个目标本身结不出什么果实。
如果你有机会和能动性，但智力低下，那么你永远无法充分利用那个机会。</p>
<p>我想重点谈谈在其他两个成分和这封信的语境下，什么是<strong>智力</strong>。为此，我们需要引入<strong>控制论 (Cybernetics)</strong>。
Cybernetics 源自希腊语 <em>kybernetikos</em>，意为“掌舵”或“善于掌舵”。
它也被称为“<strong>得到你想要东西的艺术</strong>”。
所以，如果 Naval 对智力的定义是“从生活中得到你想要的东西”，那么理解控制论可以助你一臂之力。</p>
<p>控制论阐述了智能系统运作的属性：</p>
<ul>
<li>设定一个目标。</li>
<li>朝着该目标行动。</li>
<li>感知你当前的位置。</li>
<li>将其与目标进行比对。</li>
<li>根据反馈调整，再次行动。</li>
</ul>
<p>你可以根据一个系统迭代和在试错中坚持的能力，来判断其智能程度。
一艘被风吹偏的船修正航向驶向目的地；恒温器感知温度变化并启动调节；胰腺在血糖飙升后分泌胰岛素。
这与“从生活中得到你想要的东西”有什么关系？
<strong>关系大若天。</strong>
行动、感知、比对，并从<strong>元视角 (Meta-perspective)</strong> 理解系统，这是高智力的基础。</p>
<p><strong>高智力是迭代、坚持和理解大局的能力。</strong> 低智力的标志是无法从错误中吸取教训。
低智力的人被困在问题里，而不是解决它们。他们一遇到路障就放弃。就像一个作家因为初期没有读者就放弃写作，这正因为他们缺乏尝试新事物、实验并找出适合自己流程的能力。</p>
<p><strong>高智力是意识到任何问题都可以在足够长的时间尺度上被解决。</strong> 现实是，只要你下定决心，你可以实现几乎任何目标。
智力意味着意识到：<strong>有一系列选择可以引导你实现你想要的目标</strong>。你明白想法是有层级的，你不能指望一步登天，从莎草纸直接跳跃到 Google Docs。即使那个目标现在看起来“不可能”，那只是因为你目前还缺乏资源——而这些资源可能会在未来几年内被发明出来——去实现那件事。</p>
<p>我是从<strong>目的论</strong>或希腊宇宙观（<em>kosmos</em>）的视角来阐述的——即万物皆有目的，万物皆是宏大整体的一部分。
目标决定了你如何看待世界。
目标决定了你定义什么是“成功”，什么是“失败”。
你可以尝试“享受旅程”，但如果你追求的是一个错误的目标，你绝对不会享受这段旅程。</p>
<p>你的心智是现实的操作系统。
这个系统是由<strong>目标</strong>编写而成的。
对于大多数人来说，这些目标是被别人分配的。像代码行一样被编程进你的潜意识里。
“上学、找工作、被冒犯、扮演受害者、65 岁退休。”
这是一条已被证实<strong>行不通</strong>的已知路径。</p>
<p>要变得更聪明，你必须：</p>
<ul>
<li>拒绝已知路径</li>
<li>潜入未知</li>
<li>设定新的、更高的目标来扩展你的心智带宽</li>
<li>拥抱混乱并允许成长</li>
<li>研究大自然的普遍原则</li>
<li>成为一名深度通才 (Deep Generalist)</li>
</ul>
<p>我明白这可能不是智力的传统定义，但这套步骤会导致你大脑神经产生非凡的连接，造就我们在生活中观察到的绝顶聪明之人。将其与能动性结合，你就成了赢家。</p>
<h2 id="vi--如何在-1-天内开启全新的生活">VI – 如何在 1 天内开启全新的生活</h2>
<p>我一生中最好的时期，总是在我对“缺乏进步”感到<strong>彻底厌倦</strong>之后到来的。
你如何深入你的心智深处？
你如何意识到你是如何被制约的？
你如何获得改变人生轨迹的深刻洞见和真理？
答案是：通过简单但往往<strong>痛苦</strong>的提问。
很少有人这样做。通过人们说话的方式或对特定话题的看法，你就能看出来他们缺乏这种思考。提问本身就是思考，可惜鲜有人为之。</p>
<p>我想给你一套全面的<strong>协议 (Protocol)</strong>，你可以每年使用它来重置你的生活，并开启一个充满进步的季节。这套协议将帮助你提出正确的问题。
这些问题涵盖从宏观到微观：你想在哪里？你需要做什么才能到达那里？你可以立即做什么来开始向那个现实移动？</p>
<p>这需要<strong>一整天</strong>的时间来完成，所以我建议你严格遵循这套协议。你需要准备笔、纸和一颗开放的心。
当我观察那些成功实现“身份翻转”的人时，我发现这种改变通常是在内在张力积累到极点后迅速发生的。具体来说，我注意到人们倾向于经历 3 个阶段：</p>
<ul>
<li><strong>不和谐 (Dissonance)</strong> —— 觉得这里的自己不属于当前的生活，并对缺乏进步感到极其厌倦。</li>
<li><strong>不确定性 (Uncertainty)</strong> —— 不知道接下来会发生什么，所以要么大胆实验，要么迷失方向并感觉更糟。</li>
<li><strong>发现 (Discovery)</strong> —— 发现自己真正想追求的是什么，并在 6 个月内取得过去 6 年的进步。</li>
</ul>
<p>所以，我们这个协议的目标是帮助你达到<strong>不和谐点</strong>，穿越<strong>不确定性</strong>，并<strong>发现</strong>你真正想要实现的是什么。这种清晰度将压倒一切，让分心之事不再有立足之地。</p>
<p>这个协议的结构设计为可以在一天内完成：</p>
<ul>
<li><strong>早晨</strong>：通过“心理挖掘”来揭示你自己的隐藏动机。</li>
<li><strong>白天</strong>：用“模式中断”提示自己，强行脱离自动驾驶模式并沉思你的生活。</li>
<li><strong>晚上</strong>：将这些见解综合成你明天即将启程的方向。</li>
</ul>
<p>我不能保证这对每个人都有效，因为我无法确定每个阅读此文的人是否都处于人生的正确篇章，能否让这些点产生共鸣。你不能把高潮放在书的开头并期望它有趣。但如果你准备好了，这将是你的转折点。</p>
<h3 id="第一部分早晨--心理挖掘--愿景与反向愿景">第一部分）早晨 – 心理挖掘 – 愿景与“反向愿景”</h3>
<p>首先，我们必须为你的心智创造一个新的框架，或者说一个新的感知透镜。
这就像创造一个新的躯壳。你离开旧的躯壳，随着时间的推移慢慢长入新的躯壳中。起初它会感觉不合身，甚至别扭。<strong>那是件好事。</strong></p>
<p>留出 15-30 分钟，深入思考并如实回答这些问题：</p>
<ol>
<li>什么是你已经学会<strong>忍受</strong>的那种沉闷且持续的不满？（不是那种撕心裂肺的痛苦，而是你已经麻木、学会容忍的东西。）</li>
<li>有什么事是你反复抱怨但<strong>从未真正改变</strong>的？写下过去一年你最常挂在嘴边的三个抱怨。</li>
<li>对于每个抱怨：如果有一个旁观者只观察你的<strong>行为</strong>（而不是听你的话），他会得出结论：<strong>你其实想要什么？</strong></li>
<li>关于你当前生活的什么真相，是让你向一位你深深尊敬的人承认时，会感到<strong>无法忍受</strong>的？</li>
</ol>
<p>这些问题旨在逼你直面当前生活中的痛点。现在，我们需要将这些痛点转化为我所说的<strong>反向愿景 (Anti-Vision)</strong>——即对你绝不想过的人生的残酷觉知。</p>
<ol start="5">
<li>如果未来五年绝对没有任何改变，描述一个<strong>普通的周二</strong>。你在哪里醒来？你的身体感觉如何？你脑海中第一个念头是什么？谁在你身边？早九点到晚六点你在做什么？晚上十点你心情如何？</li>
<li>现在，把时间拉长到<strong>十年</strong>。做同样的描述。你错过了什么？什么机会永远对你关闭了？谁放弃了你？当你不在房间里时，人们怎么评价你？</li>
<li>想象你走到了生命的尽头。你过完了这“安全”的一生，从未打破模式。<strong>代价是什么？</strong> 你从未让自己去感受、尝试或成为什么？</li>
<li>在你的生活中，谁<strong>已经</strong>在过你刚刚描述的那种（你不想要的）未来？那些在同一轨迹上领先你五、十、二十年的人？当你想到变成他们时，你有什么生理反应？</li>
<li>为了真正改变，你必须<strong>杀死</strong>哪个身份？（“我就是那种……的人”）不再做那个人，会在社交层面上让你付出什么代价？</li>
<li>你迟迟不改变的那个<strong>最尴尬的原因</strong>是什么？那个让你听起来软弱、胆怯或懒惰，而不是听起来“理性”的原因？</li>
<li>如果你目前的行为其实是一种<strong>自我保护</strong>，你到底在保护什么？这种保护让你付出了什么代价？</li>
</ol>
<p>如果你诚实地回答了这些问题，你会感到深深的不适，甚至可能感到恶心反胃。<strong>很好。</strong> 现在，我们需要将这种能量导向积极的方向。</p>
<ol start="12">
<li>暂时忘掉“现实”与否。如果你能打个响指，在三年内过上截然不同的生活——不是“合理”的生活，而是你<strong>真正渴望</strong>的生活——那会是什么样？描述一个那时的普通周二。</li>
<li>为了让那种生活感觉自然而不是强迫，你必须<strong>对自己持有什​​样的信念</strong>？写下新的身份声明：“我是那种……的人”。</li>
<li>如果你<strong>已经是</strong>那个人，这周你会做的具体一件事是什么？</li>
</ol>
<h3 id="第二部分全天--中断自动驾驶--打破无意识模式">第二部分）全天 – 中断自动驾驶 – 打破无意识模式</h3>
<p>为了有意识地强制打破惯性模式，请在你的手机中设置闹钟提醒，并向自己提出这些拷问灵魂的问题：</p>
<ul>
<li><strong>11:00 am</strong>：我现在正在做的这件事，是在帮我<strong>逃避</strong>什么吗？</li>
<li><strong>1:30 pm</strong>：如果有人把过去两个小时拍下来，他们会得出结论：我想从生活中得到什么？</li>
<li><strong>3:15 pm</strong>：我是在向我<strong>讨厌</strong>的生活移动，还是向我<strong>想要</strong>的生活移动？</li>
<li><strong>5:00 pm</strong>：哪件<strong>最重要</strong>的事，是我一直假装不重要的？</li>
<li><strong>7:30 pm</strong>：我今天做了哪些事是出于“身份保护”（怕丢脸/怕不安全），而不是出于真正的渴望？</li>
<li><strong>9:00 pm</strong>：今天什么时候我感觉<strong>最活着</strong>？什么时候感觉<strong>最死气沉沉</strong>？</li>
</ul>
<p>通勤或散步时的额外沉思：</p>
<ul>
<li>如果我不再需要人们将我视为 [你在问题 10 中写的旧身份]，我的生活会发生什么变化？</li>
<li>在我生活的哪个领域，我正在用<strong>活力</strong>换取<strong>安全感</strong>？</li>
<li>明天我可以成为“我想成为的人”的<strong>最小版本</strong>是什么？</li>
</ul>
<h3 id="第三部分晚上--综合见解--进入进步的季节">第三部分）晚上 – 综合见解 – 进入进步的季节</h3>
<p>一天结束时，整合你获得的见解：</p>
<ol>
<li>关于你为何被困住，哪一点感觉<strong>最真实</strong>？</li>
<li><strong>真正的敌人</strong>是什么？给这个内部模式或信念起个名字。</li>
<li>写一个句子，捕捉你<strong>绝不</strong>允许你的生活变成的样子（<strong>反向愿景</strong>）。</li>
<li>写一个句子，捕捉你正在朝着什么建设（<strong>愿景 MVP</strong>）。</li>
</ol>
<p>基于视角设定目标：</p>
<ul>
<li><strong>一年镜头</strong>：一年后必须发生什么（什么是真实的），才能让你确信你已经<strong>打破了旧模式</strong>？</li>
<li><strong>一个月镜头</strong>：为了让“一年镜头”保持可能，<strong>一个月后</strong>必须达成什么？</li>
<li><strong>每日镜头</strong>：你明天可以安排（Timeblock）哪 <strong>2-3 个具体行动</strong>，是那个“你正在成为的人”<strong>理所当然</strong>会做的事？</li>
</ul>
<h2 id="vii--把你的生活变成电子游戏">VII – 把你的生活变成电子游戏</h2>
<blockquote>
<p>“内心体验的最佳状态是意识中有秩序。当精神能量——或注意力——投入到现实的目标中，并且技能与行动机会相匹配时，就会发生这种情况。追求目标会在意识中带来秩序，因为一个人必须集中注意力于手头的任务，并暂时忘记其他一切。”
– 米哈里·契克森米哈赖 (Mihaly Csikszentmihalyi, 《心流》作者)</p>
</blockquote>
<p>把你的见解组织成一个连贯的计划：</p>
<ul>
<li><strong>反向愿景 (Anti-vision)</strong> – 什么是你存在的梦魇？</li>
<li><strong>愿景 (Vision)</strong> – 你理想的生活到底是什么样的？</li>
<li><strong>1 年目标</strong> – 1 年后我的生活会变成什么样？（具体图景）</li>
<li><strong>1 个月项目</strong> – 我需要学习什么或构建什么？</li>
<li><strong>每日杠杆 (Daily Levers)</strong> – 必须完成的优先任务是什么？</li>
<li><strong>约束 (Constraints)</strong> – 我不愿意牺牲什么？（或者为了目标必须牺牲什么娱乐？）</li>
</ul>
<p>为什么这如此强大？因为你把你的生活变成了一场<strong>电子游戏</strong>：</p>
<ul>
<li>你的<strong>愿景</strong>就是游戏的<strong>胜利条件</strong>。</li>
<li>你的<strong>反向愿景</strong>是<strong>赌注</strong>（Game Over 的代价）。</li>
<li>你的<strong>1 年目标</strong>是<strong>主线任务</strong>。</li>
<li>你的<strong>1 个月项目</strong>是<strong>Boss 战</strong>。</li>
<li>你的<strong>每日杠杆</strong>是<strong>日常任务 (Quests)</strong>。</li>
<li>你的<strong>约束</strong>是<strong>游戏规则</strong>。</li>
</ul>
<p>所有这些都充当一个力场，保护你的思想免受分心。你玩游戏的次数越多，它就越成为你是谁。</p>
<p>– Dan</p>]]></content:encoded>
    </item>
    
    <item>
      <title>Cloudflare 配置页面重定向</title>
      <link>https://blog.kylegeeks.com/posts/2026/01/cloudflare-page-redirect/</link>
      <pubDate>Wed, 07 Jan 2026 10:00:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2026/01/cloudflare-page-redirect/</guid>
      <description>&lt;h2 id=&#34;背景&#34;&gt;背景&lt;/h2&gt;
&lt;p&gt;在通过一些 &lt;code&gt;PV&lt;/code&gt; 统计工具的时候发现不同的 &lt;code&gt;URL&lt;/code&gt; 访问同个 &lt;code&gt;Web&lt;/code&gt; 不会累计统计。&lt;br&gt;
所以想通过重定向的方式来把几个不同的 &lt;code&gt;URL&lt;/code&gt; 都统一到一个。&lt;/p&gt;</description>
      <content:encoded><![CDATA[<h2 id="背景">背景</h2>
<p>在通过一些 <code>PV</code> 统计工具的时候发现不同的 <code>URL</code> 访问同个 <code>Web</code> 不会累计统计。<br>
所以想通过重定向的方式来把几个不同的 <code>URL</code> 都统一到一个。</p>
<h2 id="状态码-重定向">状态码-重定向</h2>
<p><code>HTTP</code> 通过 <code>Header</code> 的 <code>Location</code> 和 <code>HTTP code</code> 来告诉客户端当前资源不在此，需要访问新的 <code>URL</code>。</p>
<p>常见重定向类型：</p>
<p><strong>301</strong>: <code>Moved Permanently</code> 永久重定向</p>
<ul>
<li>资源已永久迁移</li>
<li>浏览器会缓存</li>
<li>搜索引擎转移权重</li>
</ul>
<p><strong>302</strong>: <code>Found</code> 临时重定向</p>
<ul>
<li>浏览器不会缓存</li>
<li>登录页面跳转</li>
<li>活动页、短链服务</li>
</ul>
<h2 id="目标">目标</h2>
<p>访问 <code>www.kylegeeks.com</code> 重定向到 <code>blog.kylegeeks.com</code></p>
<h2 id="配置-dns-记录">配置 DNS 记录</h2>
<p>打开 <strong>DNS</strong> → <strong>记录</strong></p>
<ol>
<li>添加一条 <code>DNS</code> 规则</li>
<li>类型：<code>A</code></li>
<li>IP 地址：<code>1.2.3.4</code>，任意可保存的 <code>IPv4</code> 地址应该都可以，最后也不会起作用</li>
<li>记得打开代理</li>
<li>保存即可</li>
</ol>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2026/01/389c1d059867355870631dea6ec0a4d5.png" alt="配置 DNS"  /></p>
<h2 id="配置页面规则">配置页面规则</h2>
<p>打开 <strong>规则</strong> → <strong>页面规则</strong> → <strong>创建页面规则</strong></p>
<ol>
<li>URL：<code>www.kylegeeks.com/</code></li>
<li>设置：转发 <code>URL</code></li>
<li>选择状态码：<code>301</code> - 永久重定向</li>
<li>输入目标 URL：<code>https://blog.kylegeeks.com</code><br>
必须 <code>http://</code>、<code>https://</code> 或 <code>/</code> 开头</li>
<li>保存页面规则</li>
</ol>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2026/01/d0be7975fb6ca97b8d9dc71e7141c4ba.png" alt="创建页面规则"  /></p>
<h2 id="尝试访问">尝试访问</h2>
<p>可以试一试配置是否生效了</p>
<ol>
<li>按下 <code>F12</code> 打开开发者工具</li>
<li>在浏览器输入 <code>www.kylegeeks.com</code> 并访问</li>
<li>页面浏览器的 <code>URL</code> 是 <code>https://blog.kylegeeks.com</code>，也是该博客地址</li>
<li>可以看到 <code>Response Headers</code> 返回状态码 <code>301</code> 和 <code>location</code></li>
</ol>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>HTTP/2 <span style="color:#2aa198">301</span>
</span></span><span style="display:flex;"><span>date: Wed, <span style="color:#2aa198">07</span> Jan <span style="color:#2aa198">2026</span> 13:02:14 GMT
</span></span><span style="display:flex;"><span>content-length: <span style="color:#2aa198">0</span>
</span></span><span style="display:flex;"><span>location: https://blog.kylegeeks.com
</span></span><span style="display:flex;"><span>vary: accept-encoding
</span></span><span style="display:flex;"><span>report-to: <span style="color:#719e07">{</span><span style="color:#2aa198">&#34;group&#34;</span>:<span style="color:#2aa198">&#34;cf-nel&#34;</span>,<span style="color:#2aa198">&#34;max_age&#34;</span>:604800,<span style="color:#2aa198">&#34;endpoints&#34;</span>:<span style="color:#719e07">[{</span><span style="color:#2aa198">&#34;url&#34;</span>:<span style="color:#2aa198">&#34;https://a.nel.cloudflare.com/report/v4?s=CFYa4R5UXjP0S9GYrl%2FoEgRjKNFs%2BoZ%2Fg1ZVUzoVScgonx%2BjjQcwfib93dP1gv0DhAYsc9eFJ5Ji4OJK%2F5P3XruqDqIagNPclsdWbuy%2FqweZ&#34;</span><span style="color:#719e07">}]}</span>
</span></span><span style="display:flex;"><span>nel: <span style="color:#719e07">{</span><span style="color:#2aa198">&#34;report_to&#34;</span>:<span style="color:#2aa198">&#34;cf-nel&#34;</span>,<span style="color:#2aa198">&#34;success_fraction&#34;</span>:0.0,<span style="color:#2aa198">&#34;max_age&#34;</span>:604800<span style="color:#719e07">}</span>
</span></span><span style="display:flex;"><span>server-timing: cfEdge;<span style="color:#268bd2">dur</span><span style="color:#719e07">=</span>3,cfOrigin;<span style="color:#268bd2">dur</span><span style="color:#719e07">=</span><span style="color:#2aa198">0</span>
</span></span><span style="display:flex;"><span>server: cloudflare
</span></span><span style="display:flex;"><span>cf-ray: 9ba3a5fd48cf58e6-NRT
</span></span><span style="display:flex;"><span>alt-svc: <span style="color:#268bd2">h3</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;:443&#34;</span>; <span style="color:#268bd2">ma</span><span style="color:#719e07">=</span><span style="color:#2aa198">86400</span>
</span></span><span style="display:flex;"><span>X-Firefox-Spdy: h2
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="参考">参考</h2>
<ol>
<li>
<p><a href="https://ioioxlab.com/posts/use-cloudflare-page-rule-301-redirect/">使用 Cloudflare 的页面规则进行 301 重定向</a></p>
</li>
<li>
<p><a href="https://developer.aliyun.com/article/1669551">301/302 重定向全面指南：从原理到实践</a></p>
</li>
</ol>]]></content:encoded>
    </item>
    
    <item>
      <title>Hugo 添加 Giscus 作为评论系统</title>
      <link>https://blog.kylegeeks.com/posts/2025/12/hugo-add-giscus-as-comment-system/</link>
      <pubDate>Tue, 16 Dec 2025 09:50:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2025/12/hugo-add-giscus-as-comment-system/</guid>
      <description>给 Hugo 添加 Giscus 的记录过程</description>
      <content:encoded><![CDATA[<p>一直在看别人的博客，发现别人的博客都有评论系统，我也想集成一个进我的博客里</p>
<p>可以在 Hugo 的官方翻到 <code>Content Management</code> 里 <a href="https://gohugo.io/content-management/comments/">Commnet</a>
的内容，虽然内容草草写了下配置 <code>Disqus</code>, 但在最后面提供一些开源评论系统的选择。</p>
<blockquote>
<p>Open-source commenting systems:</p>
<ul>
<li>Cactus Comments</li>
<li>Comentario</li>
<li>Comma</li>
<li>Commento</li>
<li>Discourse</li>
<li>Giscus</li>
<li>Isso</li>
<li>Remark42</li>
<li>Staticman</li>
<li>Talkyard</li>
<li>Utterances</li>
</ul>
</blockquote>
<p>本着能免费使用就免费的原则，选择依托于 <code>GitHub</code> 的 <code>feature</code> 搭建的方法，这样就不需要自建数据库了。</p>
<p>这样就只剩下 <a href="https://giscus.app/">Giscus</a> 和 <a href="https://utteranc.es/">Utterances</a> 了</p>
<p><code>Giscus</code> 是基于 <code>GitHub Discussions</code> 实现的评论系统，而 <code>Utterances</code> 是基于 <code>GitHub Issues</code> 实现的评论系统。</p>
<p><code>Giscus</code> 是受 <code>Utterances</code> 启发的项目，至少在 <code>README</code> 里是这么写的，会比 <code>Utterances</code> 更新一点。我对比了下 UI，个人更喜欢 <code>Giscus</code> 的扁平一点的风格。</p>
<p>接下来就让我们为博客引入 <code>Giscus</code> 吧</p>
<h2 id="创建-gitub-仓库">创建 Gitub 仓库</h2>
<p>首先需要新建一个<a href="https://github.com/new">新的公共仓库</a>，仓库需要是公共的，不然访客将无法查看 <code>Discussion</code>
我推荐不使用旧的仓库，主要是不想和其他已有的项目耦合，我推荐这样的做法。</p>
<p>仓库默认是不打开 <code>Discussions</code> 功能的，需要我们手动开启。</p>
<p>菜单路径: <code>Settings -&gt; General -&gt; Features -&gt; Discussions</code></p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/12/6c1ed56a2cd967402f572b96c7831bca.png" alt="Enable Discussions"  /></p>
<h2 id="github-安装-giscus">Github 安装 Giscus</h2>
<p>Github 安装 <a href="https://github.com/apps/giscus">Giscus App</a></p>
<p>点击 <code>Configure</code> 进入配置， <code>Giscus</code> 的仓库访问权限只要选择我们刚刚创建的新仓库</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/12/3823c5f38423e88d350ea64c2233e901.png" alt="Giscus Configue"  /></p>
<h2 id="giscus-的配置"><code>Giscus</code> 的配置</h2>
<p>访问 <a href="https://giscus.app/zh-CN">giscus.app</a></p>
<p>主要填写仓库路径和 <code>Discussion</code> 分类</p>
<p>仓库路径的格式为 <code>{{用户名}}/{{仓库名}}</code>

  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/12/c4d76a2706d728f2c4a1c2a17f97fa31.png" alt="Giscus 仓库路径"  /></p>
<p><code>Discussion</code> 分类推荐 <code>Announcements</code>, 以确保新 <code>Discussion</code> 只能由仓库维护者和 <code>Giscus</code> 创建。

  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/12/b18fdc003118f12d034c52e95883748f.png" alt="Giscus Discussion 分类"  /></p>
<p>接下来把要把 <code>启用 giscus</code> 下的 <code>script</code> 代码复制出，待会需要添加到 <code>Hugo</code> 里</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#268bd2">script</span>
</span></span><span style="display:flex;"><span>  src<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;https://giscus.app/client.js&#34;</span>
</span></span><span style="display:flex;"><span>  data-repo<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;[在此输入仓库]&#34;</span>
</span></span><span style="display:flex;"><span>  data-repo-id<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;[在此输入仓库 ID]&#34;</span>
</span></span><span style="display:flex;"><span>  data-category<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;[在此输入分类名]&#34;</span>
</span></span><span style="display:flex;"><span>  data-category-id<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;[在此输入分类 ID]&#34;</span>
</span></span><span style="display:flex;"><span>  data-mapping<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;pathname&#34;</span>
</span></span><span style="display:flex;"><span>  data-strict<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>  data-reactions-enabled<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>  data-emit-metadata<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;0&#34;</span>
</span></span><span style="display:flex;"><span>  data-input-position<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;bottom&#34;</span>
</span></span><span style="display:flex;"><span>  data-theme<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;preferred_color_scheme&#34;</span>
</span></span><span style="display:flex;"><span>  data-lang<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;zh-CN&#34;</span>
</span></span><span style="display:flex;"><span>  crossorigin<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;anonymous&#34;</span>
</span></span><span style="display:flex;"><span>  async
</span></span><span style="display:flex;"><span>&gt;&lt;/<span style="color:#268bd2">script</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hugo-添加-giscus-评论系统">Hugo 添加 <code>Giscus</code> 评论系统</h2>
<p>我偷懒不想修改现有主题的代码，选择覆盖主题的 <code>comments.html</code> 文件
在 <code>layouts/partials/</code> 下新建 <code>comments.html</code> 文件</p>
<p>把刚刚复制出来的代码粘贴到 <code>comments.html</code> 里</p>
<p>启动 Hugo <code>hugo server --disableFastRender</code>, 打开任何一篇文章页面看看是否在最下方出现了评论系统</p>
<p>成功之后，效果如下

  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/12/8450d5bc58ded442cffb5b640d248129.png" alt="添加 Giscus 效果"  /></p>
<p>这里有一点不足的地方就是选择切换暗色主题后， <code>Giscus</code> 不会自动适配，这需要我们自己写代码适配了</p>
<p>主要逻辑是在切换主题的时候把 <code>script</code> 的 <code>data-theme</code> <code>attribute</code> 修改为暗色或亮色主题</p>
<h2 id="支持切换亮色暗色主题">支持切换亮色暗色主题</h2>
<p>我用的是 <a href="https://github.com/reorx/hugo-PaperModX/">hugo-PaperModX</a> 主题，<code>reorx</code> 已经适配了几款评论系统了，也支持主题色切换，我就参考了他的代码适配了下 <code>Giscus</code></p>
<p>把上面的 <code>comment.html</code> 修改为</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">51
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#268bd2">div</span> class<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;comments-box giscus-widget&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#268bd2">div</span> id<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;giscus-widget-container&#34;</span>&gt;&lt;/<span style="color:#268bd2">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#268bd2">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#268bd2">script</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">var</span> giscus_config <span style="color:#719e07">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-repo&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;[在此输入]&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-repo-id&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;[在此输入]&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-category&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;Announcements&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-category-id&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;[在此输入]&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-mapping&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;pathname&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-strict&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-reactions-enabled&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-emit-metadata&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-input-position&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;bottom&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-lang&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;en&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#34;data-theme&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;noborder_light&#34;</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (<span style="color:#268bd2">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">const</span> key <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;giscus-widget&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">if</span> (<span style="color:#719e07">!</span>toggleThemeCallbacks.hasOwnProperty(key)) {
</span></span><span style="display:flex;"><span>      toggleThemeCallbacks[key] <span style="color:#719e07">=</span> (isDark) =&gt; {
</span></span><span style="display:flex;"><span>        loadgiscus(<span style="color:#719e07">!</span>isDark);
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">function</span> loadgiscus(isDark) {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">const</span> container <span style="color:#719e07">=</span> <span style="color:#b58900">document</span>.querySelector(<span style="color:#2aa198">&#34;#giscus-widget-container&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#719e07">if</span> (<span style="color:#719e07">!</span>container) <span style="color:#719e07">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      container.innerHTML <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">const</span> s <span style="color:#719e07">=</span> <span style="color:#b58900">document</span>.createElement(<span style="color:#2aa198">&#34;script&#34;</span>);
</span></span><span style="display:flex;"><span>      s.src <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;https://giscus.app/client.js&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#719e07">for</span> (<span style="color:#268bd2">const</span> key <span style="color:#719e07">in</span> giscus_config) {
</span></span><span style="display:flex;"><span>        s.setAttribute(key, giscus_config[key]);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      s.<span style="color:#268bd2">async</span> <span style="color:#719e07">=</span> <span style="color:#cb4b16">true</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#719e07">if</span> (isDark) {
</span></span><span style="display:flex;"><span>        s.setAttribute(<span style="color:#2aa198">&#34;data-theme&#34;</span>, <span style="color:#2aa198">&#34;noborder_gray&#34;</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#719e07">else</span> {
</span></span><span style="display:flex;"><span>        s.setAttribute(<span style="color:#2aa198">&#34;data-theme&#34;</span>, <span style="color:#2aa198">&#34;noborder_light&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      s.setAttribute(<span style="color:#2aa198">&#34;data-no-instant&#34;</span>, <span style="color:#2aa198">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>      container.appendChild(s);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    loadgiscus(isDarkTheme());
</span></span><span style="display:flex;"><span>  })();
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#268bd2">script</span>&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>点击主题切换后, 支持后的暗色主题效果</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/12/39cf03a813a537c74c9605f21afcf025.png" alt="适配暗色主题"  /></p>
<p>以上就是我为我的博客添加 <code>Giscus</code> 作为评论系统的主要内容啦，闲暇时间折腾下博客还是挺有意思的。</p>
<p>现在已经是 2025 年 12 月 了，希望 2026 年的自己能多输出，多分享技术和生活内容，也希望在互联网上有读者来我的博客留下自己的脚步 👣。</p>]]></content:encoded>
    </item>
    
    <item>
      <title>整数向上取整公式证明</title>
      <link>https://blog.kylegeeks.com/posts/2025/05/ceil-for-integers/</link>
      <pubDate>Fri, 23 May 2025 10:00:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2025/05/ceil-for-integers/</guid>
      <description>&lt;p&gt;数学公式在编程里的应用: 整数向上取整公式，常用于分页，分片的场景&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>数学公式在编程里的应用: 整数向上取整公式，常用于分页，分片的场景</p>
<h2 id="背景">背景</h2>
<p>在用 <code>AI</code> 编程的时候，让它给我生成一个分页处理的工具类:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> List<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> <span style="color:#268bd2">paginate</span>(List<span style="color:#719e07">&lt;</span>T<span style="color:#719e07">&gt;</span> list, <span style="color:#dc322f">int</span> page, <span style="color:#dc322f">int</span> pageSize) {
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">if</span> (list <span style="color:#719e07">==</span> <span style="color:#cb4b16">null</span> <span style="color:#719e07">||</span> list.isEmpty()) {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">return</span> Collections.emptyList();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">if</span> (pageSize <span style="color:#719e07">&lt;=</span> 0) {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> IllegalArgumentException(<span style="color:#2aa198">&#34;pageSize must be greater than 0&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#dc322f">int</span> total <span style="color:#719e07">=</span> list.size();
</span></span><span style="display:flex;"><span>    <span style="color:#dc322f">int</span> totalPages <span style="color:#719e07">=</span> (total <span style="color:#719e07">+</span> pageSize <span style="color:#719e07">-</span> 1) <span style="color:#719e07">/</span> pageSize;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#dc322f">int</span> safePage <span style="color:#719e07">=</span> Math.max(1, page);
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">if</span> (safePage <span style="color:#719e07">&gt;</span> totalPages) {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">return</span> Collections.emptyList();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#dc322f">int</span> skip <span style="color:#719e07">=</span> (safePage <span style="color:#719e07">-</span> 1) <span style="color:#719e07">*</span> pageSize;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">return</span> list.stream()
</span></span><span style="display:flex;"><span>            .skip(skip)
</span></span><span style="display:flex;"><span>            .limit(pageSize)
</span></span><span style="display:flex;"><span>            .collect(Collectors.toList());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 Review 生成代码的时候，发现求总页数的计算让我有点好奇，为什么它用这个公式
求总页数: 总数除于分页大小, 如果余数大 0，就加一。在编程里，整数相除一般是向下取整，我第一反应想到的逻辑是：先除，后取模，根据取模结果判断是否 +1，btw，看 <code>Mybatis Plus</code> 的代码，发现他也是这么设计的:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#586e75">/**
</span></span></span><span style="display:flex;"><span><span style="color:#586e75">     * 当前分页总页数
</span></span></span><span style="display:flex;"><span><span style="color:#586e75">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">default</span> <span style="color:#dc322f">long</span> <span style="color:#268bd2">getPages</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">if</span> (getSize() <span style="color:#719e07">==</span> 0) {
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">return</span> 0L;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#dc322f">long</span> pages <span style="color:#719e07">=</span> getTotal() <span style="color:#719e07">/</span> getSize();
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">if</span> (getTotal() <span style="color:#719e07">%</span> getSize() <span style="color:#719e07">!=</span> 0) {
</span></span><span style="display:flex;"><span>            pages<span style="color:#719e07">++</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">return</span> pages;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><p>所以 AI 给我的这个计算方式着实让我好奇:</p>
<p><code>(total + pageSize - 1) / pageSize;</code></p>
<p>我很好奇，为什么是加<code>b-1</code> 和除以<code>b</code></p>
<p>所以后来，我向 <code>ChaptGPT</code> 老师请教了如何证明这个公式是有效的。</p>
<h2 id="证明过程">证明过程</h2>
<p><code>向上取整除法</code> 的核心公式是：</p>
<p>$$ \left\lceil \frac{a}{b} \right\rceil = \frac{a + b - 1}{b} $$</p>
<p>前提：</p>
<ul>
<li>a ≥ 0, b &gt; 0</li>
<li>除法采用整数除法（向下取整）</li>
<li>所有变量为整数</li>
</ul>
<h3 id="目标">目标</h3>
<p>我们要证明这个公式：</p>
<p>$$ \left\lceil \frac{a}{b} \right\rceil = \frac{a + b - 1}{b} $$</p>
<p>右边是整数除法（向下取整），但通过 +b-1 的技巧实现了向上取整效果。</p>
<h3 id="整数除法基础商和余">整数除法基础（商和余）</h3>
<p>设 a = bq + r，其中：</p>
<ul>
<li>q = a / b 是向下取整的商</li>
<li>r = a % b 是余数，满足 0 ≤ r &lt; b</li>
</ul>
<p>因此：</p>
<ul>
<li>如果 r = 0：说明 a 被 b 整除，结果无需进位。</li>
<li>如果 r &gt; 0：则需进一位，即向上取整。</li>
</ul>
<h3 id="定义">定义</h3>
<p>定义：</p>
<p>$$
\left\lceil \frac{a}{b} \right\rceil =
\begin{cases}
q, &amp; \text{if } r = 0 \\
q + 1, &amp; \text{if } r &gt; 0
\end{cases}
$$</p>
<h3 id="分情况讨论">分情况讨论</h3>
<h4 id="当-r--0-时">当 r = 0 时</h4>
<ul>
<li>a = bq</li>
<li>a + b - 1 = bq + b - 1</li>
</ul>
<p>代入</p>
<p>$$ \frac{a + b - 1}{b} $$</p>
<p>得到:</p>
<p>$$
\frac{a + b - 1}{b} = \frac{bq + b - 1}{b} =
q + \left( \frac{b - 1}{b} \right)
$$</p>
<p>因为整数除法是向下取整的， (b - 1) &lt; b , 所以 (b - 1)/b 为 0</p>
<p>所以证明得</p>
<p>$$
\frac{a + b - 1}{b} = \frac{b(q + 1) - 1}{b} = q
$$</p>
<h4 id="当-r--0-时-1">当 r &gt; 0 时</h4>
<ul>
<li>a = bq + r, 0 &lt; r &lt; b</li>
<li>a + b - 1 = bq + r + b - 1 = b(q + 1) + (r - 1)</li>
</ul>
<p>代入</p>
<p>$$ \frac{a + b - 1}{b} $$</p>
<p>得到:</p>
<p>$$
\left( \frac{a + b - 1}{b} \right)
= \left( \frac{b(q + 1) + (r - 1)}{b} \right)
= (q + 1) + \left( \frac{r - 1}{b} \right)
$$</p>
<p>讨论 (r - 1) 和 b
因为 0 &lt; r &lt; b , 所以 -1 &lt; r - 1 &lt; b - 1 &lt; b 得 r-1 &lt; b
所以</p>
<p>$$ \left( \frac{r - 1}{b} \right) = 0 $$</p>
<p>所以证明得, 当 r &gt; 0 时</p>
<p>$$ \frac{a + b - 1}{b} = (q + 1) + 0 = q + 1 $$</p>
<h2 id="结语">结语</h2>
<p>因为只是涉及整数的运算，用不到浮点运算比 JDK <code>Math</code>提供的 <code>ceil</code> 更适合分页的场景
除此之外，还能用:</p>
<ul>
<li>底层的 <code>内存块</code> / <code>缓冲区</code>申请
<blockquote>
<p>BTW, 和公司的嵌入式同事强哥提到的时候，他能脱口而出这个公式，看来对嵌入式开发来说比较常用</p>
</blockquote>
</li>
<li>文件的<code>分块</code> ，以实现断点续传或分块并行下载</li>
<li>分布式任务调度的 <code>分片计算</code></li>
<li>大数据任务计算的 <code>批处理</code></li>
</ul>]]></content:encoded>
    </item>
    
    <item>
      <title>SpringWeb 线程泄漏问题排查</title>
      <link>https://blog.kylegeeks.com/posts/2025/05/debug-tomcat-thread-issue/</link>
      <pubDate>Sun, 11 May 2025 10:00:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2025/05/debug-tomcat-thread-issue/</guid>
      <description>&lt;h2 id=&#34;现在是什么问题&#34;&gt;现在是什么问题?&lt;/h2&gt;
&lt;p&gt;最近开发环境有个服务只要是超过 2 天没有重启/构建上线的话, 都会出现请求超时的问题.弄的前端和嵌入式开发的同事老是找我麻烦 😅&lt;/p&gt;
&lt;p&gt;周末刚好有空去加班, 办公室也比较安静, 比较有耐心来排查这个问题了.&lt;/p&gt;
&lt;p&gt;开发环境虽然是个直接 &lt;code&gt;java -jar&lt;/code&gt; 部署的, 因为有用 &lt;code&gt;mircometer&lt;/code&gt; 来暴露一些监控数据, 我也是把它接入了监控了, 在 &lt;code&gt;Grafana&lt;/code&gt; 就能看到 &lt;code&gt;JVM&lt;/code&gt; 情况&lt;/p&gt;
&lt;p&gt;
  &lt;img loading=&#34;lazy&#34; src=&#34;https://image-s3.kylegeeks.com/data/2025/05/b0b6104f2d306a2c82587bfba8f8ed85.png&#34; alt=&#34;Grafana - JVM&#34;  /&gt;&lt;/p&gt;
&lt;p&gt;可以看到 &lt;code&gt;Thread&lt;/code&gt; 和 &lt;code&gt;Waithing&lt;/code&gt; 状态的 &lt;code&gt;Thread&lt;/code&gt; 不断增加, 怎么了, 看起来是线程泄漏了? 我们的代码虽然管理是不规范, 到处都有地方开线程池, 但是之前还是用的好好的呀「手动狗头」&lt;/p&gt;
&lt;p&gt;没事没事, 知道有异常出现了, 都好办, 直接上去机器上 &lt;code&gt;dump&lt;/code&gt; 一些 &lt;code&gt;log&lt;/code&gt; 出来看看就好, 我们这不还在「犯罪现场」呢嘛&lt;/p&gt;
&lt;h2 id=&#34;看看怎么个事儿&#34;&gt;看看怎么个事儿&lt;/h2&gt;
&lt;p&gt;开发环境都是丢在一台虚拟机上的, 而且就是直接 &lt;code&gt;java -jar&lt;/code&gt; 部署的
天然的让我好把日志导出来, 我直接一个 &lt;code&gt;jps -lvm&lt;/code&gt; 查看那个问题服务的 &lt;code&gt;PID&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后再来一个 &lt;code&gt;jstack&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;通过 &lt;code&gt;jstack pid &amp;gt; thread_dump.log&lt;/code&gt; 把线程和上下文都 &lt;code&gt;dump&lt;/code&gt; 出来
然后再来请上我们的 &lt;code&gt;Linux&lt;/code&gt; 三剑客之二: &lt;code&gt;awk&lt;/code&gt;, &lt;code&gt;grep&lt;/code&gt;&lt;/p&gt;</description>
      <content:encoded><![CDATA[<h2 id="现在是什么问题">现在是什么问题?</h2>
<p>最近开发环境有个服务只要是超过 2 天没有重启/构建上线的话, 都会出现请求超时的问题.弄的前端和嵌入式开发的同事老是找我麻烦 😅</p>
<p>周末刚好有空去加班, 办公室也比较安静, 比较有耐心来排查这个问题了.</p>
<p>开发环境虽然是个直接 <code>java -jar</code> 部署的, 因为有用 <code>mircometer</code> 来暴露一些监控数据, 我也是把它接入了监控了, 在 <code>Grafana</code> 就能看到 <code>JVM</code> 情况</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/05/b0b6104f2d306a2c82587bfba8f8ed85.png" alt="Grafana - JVM"  /></p>
<p>可以看到 <code>Thread</code> 和 <code>Waithing</code> 状态的 <code>Thread</code> 不断增加, 怎么了, 看起来是线程泄漏了? 我们的代码虽然管理是不规范, 到处都有地方开线程池, 但是之前还是用的好好的呀「手动狗头」</p>
<p>没事没事, 知道有异常出现了, 都好办, 直接上去机器上 <code>dump</code> 一些 <code>log</code> 出来看看就好, 我们这不还在「犯罪现场」呢嘛</p>
<h2 id="看看怎么个事儿">看看怎么个事儿</h2>
<p>开发环境都是丢在一台虚拟机上的, 而且就是直接 <code>java -jar</code> 部署的
天然的让我好把日志导出来, 我直接一个 <code>jps -lvm</code> 查看那个问题服务的 <code>PID</code></p>
<p>然后再来一个 <code>jstack</code>:</p>
<p>通过 <code>jstack pid &gt; thread_dump.log</code> 把线程和上下文都 <code>dump</code> 出来
然后再来请上我们的 <code>Linux</code> 三剑客之二: <code>awk</code>, <code>grep</code></p>
<blockquote>
<p>这里你以为我的 Linux 命令用的很溜嘛? 其实都是 ChatGPT 给我的, 没了他我可就是个菜鸡 😭</p>
</blockquote>
<p>执行:</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>awk <span style="color:#2aa198">&#39;/^&#34;/ {thread=$0} /java.lang.Thread.State: WAITING/ {print thread}&#39;</span> thread_dump.log | awk -F<span style="color:#2aa198">&#39;&#34;&#39;</span> <span style="color:#2aa198">&#39;{print $2}&#39;</span> | tee /dev/tty | wc -l
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出:</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/05/c5142a3e8061795b159256255ce8d378.png" alt="jstack 统计"  /></p>
<p>好家伙, 大部分都是 <code>http-nio-exec-*</code> 证明都是请求没有释放还是咋地啊？</p>
<p>咱们可是都是 <code>Spring Boot</code> 工程师呢 , 用得当然是我们的 <code>SpringBoot</code> + <code>SpringWeb</code> (<code>Tomcat</code> 内置)</p>
<p>我们最近也没升级啥 <code>Tomcat</code> 的版本, 也没修改什么配置的, 到底咋个回事?</p>
<p>挑几个请求的线程看看日志吧, 发现基本都处在 <code>WAITING（Park）</code> 状态</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/05/b6b96bccd7e2a44d6f8843656969b839.png" alt="http-nio-exec 上下文"  /></p>
<p>而且几乎所有 <code>WAITING</code> 状态的都来自 <code>Druid</code> 数据库连接池获取不到链接, 争抢锁 🔒 时获取不到, 一直等待其他链接的释放.</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/05/2a4694c704726b8c7a69c745a9689828.png" alt="com.alibaba.druid.pool.DruidDataSource#getConnectionInternal"  />
我们的在服务配置的 <code>max-active = 20</code>, 说明 20 个链接可能都被占着, 一直没还回去.</p>
<p>难道是高并发? 是不是要直接把 <code>max-active</code> 调大就可以解决？ 如果我是初级开发, 我可能就会认为这样就能解决了, 毕竟舔了这堆屎山 💩 已经近 3 年之久, 我的直觉告诉我肯定是哪里有 <code>Bug</code> 导致的</p>
<p>因为还没给 <code>Druid</code> 配置连接泄漏检测, 所以只能通过业务日志排查.因为是一直有线程占数据库连接「不拉屎」, 导致后面的请求「拉不了屎」, 所以我们可以从日志最前面的几个 <code>http</code> 请求线程来看.</p>
<p>发现均来自给设备升级的业务, 这个业务的接口在开发环境一般是了半夜 2 点定时任务触发的, 很少在从客户端请求</p>
<h2 id="有点眉目了">有点眉目了</h2>
<p>本来想看能不能知道几个线程的存活时间, 通过存活时间来推算日志时间来看业务日志, 转念一想, 都已知具体触发时间, 就搭配线程名和业务关键来过滤日志吧, 就在日志的海洋 🌊 里遨游吧, 骚年</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/05/7cfa7ff50118b4c730bea53be48968af.png" alt=""  />
排查了好一会儿, 突然发现有几个 <code>Feign</code> 的调用是报错的, 通过 <code>trace</code> 来看, 看到本应该 2 点开始出发的请求, 在 9 点还有一个报错堆栈:</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/05/0725cf4b65711802fef5f1a6225bc9cf.png" alt="wait 报错堆栈"  /></p>
<p>奇怪, 怎么有一个 <code>wait</code> 被中断的报错, 而且在 过了 7 个小时才被中断.</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>java.lang.InterruptedException: null
</span></span><span style="display:flex;"><span>	at java.base/java.lang.Object.wait0<span style="color:#719e07">(</span>Native Method<span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>	at java.base/java.lang.Object.wait<span style="color:#719e07">(</span>Object.java:366<span style="color:#719e07">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>找到对应的代码, 发现是同事在解耦一个业务的时候, 想把一个兜底的定时任务去掉, 写成了一个 <code>while</code>(可能会真) 里加了个 <code>object.wait</code>(时间).</p>
<p>那么我们看下这几个一直 <code>wait</code> 的请求吧.对了, 这里的线程应该是为 <code>TIMED_WAITING</code> 状态, 因为是加了等待时间的, 只是一直在 <code>while</code> 里出不来.</p>
<h2 id="终于捉到虫">终于捉到虫</h2>
<p>再次请出我们的 <code>Linux</code> 剑客帮帮忙吧, 记得把想要找的线程状态改为 <code>TIMED_WAITING</code></p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>awk <span style="color:#2aa198">&#39;/^&#34;/ {thread=$0} /java.lang.Thread.State: TIMED_WAITING/ {print thread}&#39;</span> thread_dump.log | awk -F<span style="color:#2aa198">&#39;&#34;&#39;</span> <span style="color:#2aa198">&#39;{print $2}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出内容:</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/05/2a77023e10e7ab5583f5093d8f37f9f7.png" alt="TIMED_WAITING 线程们"  /></p>
<p>看了除了 <code>http-nio-exec-280</code> 外的日志, 都是卡在出问题的代码上:</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2025/05/c4dba2f0ba6806dabdebdcd3a80ba48f.png" alt="IMED_WAITING 报错"  /></p>
<p>而且刚好数量和配置的 <code>Druid</code> 的 <code>max-active</code> 一致, 这个 <code>Bug</code> 就在这里被排查出来了.</p>
<p>因为有个监控会定时调用「登陆」接口来判断服务是否正常, 所以后面 200+ 个请求积压都是来自「登陆」接口.</p>
<h2 id="学到了啥">学到了啥</h2>
<p>和以前排查 <code>Bug</code> 不同的是, 这次排查问题读组件源码, 通过报错堆栈搜问题, 以前会在首先会 <code>Google</code> 搜索, 现在首先是发给 <code>ChatGPT</code>.</p>
<p>虽然 <code>AI</code> 输出的内容可能比较全面, 但是还是会误导我们, 比如这次解决问题时候, 他因为不知道我们业务代码, 第一时间是让我修改数据库连接池的最大活跃数, 都是一个治标不治本的做法, 如果想要思考问题透彻点, 还是多问 <code>Why</code>, 多用第一性原理分析 🧐</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>用 Java 来实现高阶函数</title>
      <link>https://blog.kylegeeks.com/posts/2025/03/fucniton-for-java/</link>
      <pubDate>Wed, 19 Mar 2025 10:00:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2025/03/fucniton-for-java/</guid>
      <description>&lt;p&gt;如何用 &lt;code&gt;Java&lt;/code&gt; 使用高阶函数&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>如何用 <code>Java</code> 使用高阶函数</p>
<h3 id="funciton-接口的定义">Funciton 接口的定义</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#586e75">/**
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * Represents a function that accepts one argument and produces a result.
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> *
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * &lt;p&gt;This is a &lt;a href=&#34;package-summary.html&#34;&gt;functional interface&lt;/a&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * whose functional method is {@link #apply(Object)}.
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> *
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * @param &lt;T&gt; the type of the input to the function
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * @param &lt;R&gt; the type of the result of the function
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> *
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> * @since 1.8
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">@FunctionalInterface</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">interface</span> <span style="color:#268bd2">Function</span><span style="color:#719e07">&lt;</span>T, R<span style="color:#719e07">&gt;</span> {}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="代码示例">代码示例</h3>
<p>实现功能:</p>
<ul>
<li>2 次函数 apply</li>
<li>3 次函数 apply</li>
</ul>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#dc322f">void</span> <span style="color:#268bd2">main</span>(String<span style="color:#719e07">[]</span> args) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Function<span style="color:#719e07">&lt;</span>Function<span style="color:#719e07">&lt;</span>Integer, Integer<span style="color:#719e07">&gt;</span>, Function<span style="color:#719e07">&lt;</span>Integer, Integer<span style="color:#719e07">&gt;&gt;</span> applyTwice <span style="color:#719e07">=</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#586e75">//f(f(x))</span>
</span></span><span style="display:flex;"><span>            f <span style="color:#719e07">-&gt;</span> x <span style="color:#719e07">-&gt;</span> f.apply(f.apply(x));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Function<span style="color:#719e07">&lt;</span>Function<span style="color:#719e07">&lt;</span>Integer, Integer<span style="color:#719e07">&gt;</span>, Function<span style="color:#719e07">&lt;</span>Integer, Integer<span style="color:#719e07">&gt;&gt;</span> applyThrice <span style="color:#719e07">=</span>
</span></span><span style="display:flex;"><span>            f <span style="color:#719e07">-&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#719e07">return</span> x <span style="color:#719e07">-&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#586e75">//f(f(f(x)))</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#719e07">return</span> f.apply(f.apply(f.apply(x)));
</span></span><span style="display:flex;"><span>                };
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System.out.println(applyThrice.apply( x <span style="color:#719e07">-&gt;</span> x <span style="color:#719e07">+</span> 1 ).apply(0));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="第一层最外层-function">第一层：最外层 Function</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>Function<span style="color:#719e07">&lt;</span>Function<span style="color:#719e07">&lt;</span>Integer, Integer<span style="color:#719e07">&gt;</span>, Function<span style="color:#719e07">&lt;</span>Integer, Integer<span style="color:#719e07">&gt;&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个类型的输入是 <code>Function&lt;Integer, Integer&gt;</code>
输出也是 <code>Function&lt;Integer, Integer&gt;</code>。</p>
<p>换句话说，这个高阶函数的作用是：</p>
<ul>
<li>接收一个函数 <code>Funciotn&lt;Interger, Integer&gt;</code></li>
<li>返回一个新的函数 <code>Function&lt;Integer, Integer&gt;</code>，</li>
</ul>
<h3 id="第二层输入参数">第二层：输入参数</h3>
<p><code>Function&lt;Integer, Integer&gt;</code></p>
<p>这是 Java 函数接口, 输入输出参数都是 <code>Integer</code></p>
<p>比如：</p>
<p><code>Function&lt;Integer, Integer&gt; increment = x -&gt; x + 1;</code>
<code>Function&lt;Integer, Integer&gt; square = x -&gt; x * x;</code></p>
<p>这些都是 <code>Function&lt;Integer, Integer&gt;</code> 类型的函数。</p>
<h3 id="第三层-返回值-functioninteger-integer">第三层 返回值 <code>Function&lt;Integer, Integer&gt;</code></h3>
<p>最后 <code>applyThrice</code> 应该返回的是一个<code>Function&lt;Integer, Integer&gt;</code>
拆解下 <code>applyThrice.apply( x -&gt; x + 1 ).apply(0)</code></p>
<ol>
<li><code>applyThrice.apply( x -&gt; x + 1 )</code> 返回了:
<code>x -&gt; ( ( ( x + 1 ) + 1 ) + 1 )</code></li>
<li><code>.apply(0)</code> 就是把 0 作为输入 x
<code>( ( ( 0 + 1 ) + 1 ) + 1 )</code> 结果为 <code>3</code></li>
</ol>]]></content:encoded>
    </item>
    
    <item>
      <title>LangChain4J 功能架构详解</title>
      <link>https://blog.kylegeeks.com/posts/2025/02/langchain4j-tool/</link>
      <pubDate>Thu, 20 Feb 2025 10:00:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2025/02/langchain4j-tool/</guid>
      <description>通过脑图详细解析 LangChain4J 的功能架构和应用场景</description>
      <content:encoded><![CDATA[<h2 id="langchain4j-功能架构">LangChain4J 功能架构</h2>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid"> mindmap
  root((LangChain4J))
    模型集成
      OpenAI
        ChatGPT
        GPT-4
      Azure OpenAI
      Anthropic Claude
      本地模型
        Ollama
    核心功能
      Prompt Engineering
        PromptTemplate
        Few-shot Learning
        Chain of Thought
      Memory
        消息记忆
        对话历史
        向量存储
      Embedding
        文本向量化
        相似度搜索
        知识库构建
    工具集成
      RAG
        文档加载器
        文本分割
        向量数据库
      Agent
        工具调用
        任务规划
        自主决策
    应用场景
      智能客服
        多轮对话
        知识库问答
        意图识别
      文档处理
        自动摘要
        信息提取
        文档分类
      代码助手
        代码生成
        代码解释
        Bug分析
</code></pre><h2 id="功能模块详解">功能模块详解</h2>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">	classDiagram
	class A{
		&lt;&lt;interface&gt;&gt;
	}

	class B{
		&lt;&lt;interface&gt;&gt;
	}

	A --&gt; B
</code></pre><h3 id="1-模型集成">1. 模型集成</h3>
<p>LangChain4J 支持多种大语言模型的接入，包括：</p>
<ul>
<li>OpenAI 的 GPT 系列</li>
<li>Azure OpenAI 服务</li>
<li>Anthropic Claude</li>
<li>本地部署的开源模型</li>
</ul>
<h3 id="2-核心功能">2. 核心功能</h3>
<p>核心功能模块提供了构建 AI 应用的基础能力：</p>
<ul>
<li>Prompt 工程：模板管理和优化</li>
<li>记忆系统：对话历史管理</li>
<li>向量计算：文本嵌入和相似度计算</li>
</ul>
<h3 id="3-工具集成">3. 工具集成</h3>
<p>提供了丰富的工具集成能力：</p>
<ul>
<li>RAG：支持文档检索和知识库构建</li>
<li>Agent：支持复杂任务的规划和执行</li>
</ul>
<h3 id="4-应用场景">4. 应用场景</h3>
<p>常见的应用场景包括：</p>
<ul>
<li>智能客服系统</li>
<li>文档处理自动化</li>
<li>AI 辅助编程</li>
</ul>
<h2 id="总结">总结</h2>
<p>LangChain4J 提供了完整的 AI 应用开发框架，通过合理使用这些功能模块，可以快速构建强大的 AI 应用。</p>]]></content:encoded>
    </item>
    
    <item>
      <title>在 SpringBoot 中接入 LangChain4J 开发指南</title>
      <link>https://blog.kylegeeks.com/posts/2025/02/springboot-langchain4j/</link>
      <pubDate>Thu, 20 Feb 2025 10:00:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2025/02/springboot-langchain4j/</guid>
      <description>详细介绍如何在 SpringBoot 项目中集成 LangChain4J，实现 AI 能力</description>
      <content:encoded><![CDATA[<h2 id="简介">简介</h2>
<p>LangChain4j 是一个强大的 Java AI 开发框架，它可以帮助我们快速构建基于大语言模型的应用。本文将详细介绍如何在 SpringBoot 项目中集成 LangChain4J，并实现一个简单的 AI 聊天应用。</p>
<h2 id="项目架构">项目架构</h2>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
A[SpringBoot Application] --&gt; B[LangChain4J Config]
B --&gt; C[ChatLanguageModel]
B --&gt; D[MessageMemory]
C --&gt; E[OpenAI API]
A --&gt; F[ChatService]
F --&gt; C
F --&gt; D
A --&gt; G[ChatController]
G --&gt; F

style A fill:#f9f,stroke:#333,stroke-width:2px
style B fill:#bbf,stroke:#333,stroke-width:2px
style C fill:#dfd,stroke:#333,stroke-width:2px
style D fill:#dfd,stroke:#333,stroke-width:2px
style E fill:#fdd,stroke:#333,stroke-width:2px
</code></pre><h2 id="环境准备">环境准备</h2>
<ul>
<li>JDK 17+</li>
<li>SpringBoot 3.x</li>
<li>Maven/Gradle</li>
<li>OpenAI API Key</li>
</ul>
<h2 id="项目配置">项目配置</h2>
<h3 id="maven-依赖">Maven 依赖</h3>
<p>首先在 <code>pom.xml</code> 中添加必要的依赖：</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>  <span style="color:#268bd2">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75">&lt;!-- SpringBoot 基础依赖 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75">&lt;!-- LangChain4j 核心依赖 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;groupId&gt;</span>dev.langchain4j<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;artifactId&gt;</span>langchain4j<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;version&gt;</span>0.27.1<span style="color:#268bd2">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75">&lt;!-- LangChain4j Spring 集成 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;groupId&gt;</span>dev.langchain4j<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;artifactId&gt;</span>langchain4j-spring-boot-starter<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;version&gt;</span>0.27.1<span style="color:#268bd2">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75">&lt;!-- Lombok --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;groupId&gt;</span>org.projectlombok<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;artifactId&gt;</span>lombok<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&lt;optional&gt;</span>true<span style="color:#268bd2">&lt;/optional&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="配置文件">配置文件</h3>
<p>在 <code>application.yml</code> 中添加相关配置：</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#268bd2">langchain4j</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">chat-model</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">provider</span>: openai
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">api-key</span>: ${OPENAI_API_KEY}
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">model-name</span>: gpt-4
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">temperature</span>: <span style="color:#2aa198">0.7</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">timeout</span>: 60s
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">base-url</span>: https://your-gpt4-mini-api-endpoint <span style="color:#586e75"># 如果使用自定义 API</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="核心实现">核心实现</h2>
<h3 id="项目结构">项目结构</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  src/main/java/com/example/demo/
</span></span><span style="display:flex;"><span>  ├── config/
</span></span><span style="display:flex;"><span>  │   └── LangChain4jConfig.java
</span></span><span style="display:flex;"><span>  ├── service/
</span></span><span style="display:flex;"><span>  │   ├── ChatService.java
</span></span><span style="display:flex;"><span>  │   └── PromptService.java
</span></span><span style="display:flex;"><span>  ├── controller/
</span></span><span style="display:flex;"><span>  │   └── ChatController.java
</span></span><span style="display:flex;"><span>  ├── model/
</span></span><span style="display:flex;"><span>  │   ├── ChatRequest.java
</span></span><span style="display:flex;"><span>  │   └── ChatResponse.java
</span></span><span style="display:flex;"><span>  └── DemoApplication.java
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="配置类">配置类</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#268bd2">@Configuration</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">@Slf4j</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">LangChain4jConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@Value</span>(<span style="color:#2aa198">&#34;${langchain4j.chat-model.api-key}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> String apiKey;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@Value</span>(<span style="color:#2aa198">&#34;${langchain4j.chat-model.base-url}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> String baseUrl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> ChatLanguageModel <span style="color:#268bd2">chatLanguageModel</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#719e07">return</span> OpenAiChatModel.builder()
</span></span><span style="display:flex;"><span>        .apiKey(apiKey)
</span></span><span style="display:flex;"><span>        .modelName(<span style="color:#2aa198">&#34;gpt-4&#34;</span>)
</span></span><span style="display:flex;"><span>        .baseUrl(baseUrl)
</span></span><span style="display:flex;"><span>        .timeout(Duration.ofSeconds(60))
</span></span><span style="display:flex;"><span>        .temperature(0.7)
</span></span><span style="display:flex;"><span>        .logRequests(<span style="color:#cb4b16">true</span>)
</span></span><span style="display:flex;"><span>        .logResponses(<span style="color:#cb4b16">true</span>)
</span></span><span style="display:flex;"><span>        .build();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> MessageMemory <span style="color:#268bd2">messageMemory</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#719e07">return</span> MessageMemory.withMaxMessages(10);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="服务实现">服务实现</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#268bd2">@Service</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">@Slf4j</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">ChatService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> ChatLanguageModel chatModel;
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> MessageMemory memory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">ChatService</span>(ChatLanguageModel chatModel, MessageMemory memory) {
</span></span><span style="display:flex;"><span>      <span style="color:#719e07">this</span>.chatModel <span style="color:#719e07">=</span> chatModel;
</span></span><span style="display:flex;"><span>      <span style="color:#719e07">this</span>.memory <span style="color:#719e07">=</span> memory;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> String <span style="color:#268bd2">chat</span>(String userMessage) {
</span></span><span style="display:flex;"><span>      <span style="color:#719e07">try</span> {
</span></span><span style="display:flex;"><span>        memory.add(UserMessage.from(userMessage));
</span></span><span style="display:flex;"><span>        String response <span style="color:#719e07">=</span> chatModel.generate(memory.messages());
</span></span><span style="display:flex;"><span>        memory.add(AiMessage.from(response));
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">return</span> response;
</span></span><span style="display:flex;"><span>      } <span style="color:#719e07">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        log.error(<span style="color:#2aa198">&#34;AI 服务调用失败&#34;</span>, e);
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">throw</span> <span style="color:#719e07">new</span> AIException(<span style="color:#2aa198">&#34;AI 服务暂时不可用，请稍后重试&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="高级特性">高级特性</h2>
<h3 id="对话流程">对话流程</h3>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid"> sequenceDiagram
participant Client
participant Controller
participant ChatService
participant OpenAI

    Client-&gt;&gt;Controller: POST /api/chat
    Controller-&gt;&gt;ChatService: chat(message)
    ChatService-&gt;&gt;ChatService: 添加用户消息到记忆
    ChatService-&gt;&gt;OpenAI: 生成回复
    OpenAI--&gt;&gt;ChatService: 返回回复
    ChatService-&gt;&gt;ChatService: 添加 AI 回复到记忆
    ChatService--&gt;&gt;Controller: 返回回复
    Controller--&gt;&gt;Client: 返回响应

note over Client,OpenAI: 完整的对话流程
</code></pre><h3 id="prompt-模板使用">Prompt 模板使用</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#268bd2">@Service</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">PromptService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> PromptTemplate promptTemplate <span style="color:#719e07">=</span> PromptTemplate.from(
</span></span><span style="display:flex;"><span>      <span style="color:#2aa198">&#34;你是一个{{role}}，请用专业的角度回答：{{question}}&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> ChatLanguageModel chatModel;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> String <span style="color:#268bd2">getResponse</span>(String role, String question) {
</span></span><span style="display:flex;"><span>      String prompt <span style="color:#719e07">=</span> promptTemplate.apply(Parameters.from(
</span></span><span style="display:flex;"><span>        <span style="color:#2aa198">&#34;role&#34;</span>, role,
</span></span><span style="display:flex;"><span>        <span style="color:#2aa198">&#34;question&#34;</span>, question
</span></span><span style="display:flex;"><span>      ));
</span></span><span style="display:flex;"><span>      <span style="color:#719e07">return</span> chatModel.generate(prompt);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="最佳实践">最佳实践</h2>
<ol>
<li>
<p>使用环境变量或配置中心存储 API Key</p>
</li>
<li>
<p>避免直接在代码中硬编码敏感信息</p>
</li>
<li>
<p>定期轮换 API Key</p>
</li>
<li>
<p>使用异步处理长时间运行的 AI 请求</p>
</li>
<li>
<p>实现请求缓存减少 API 调用</p>
</li>
<li>
<p>合理设置超时时间和重试策略</p>
</li>
<li>
<p>实现 Token 计数和使用统计</p>
</li>
<li>
<p>设置调用限额</p>
</li>
<li>
<p>监控 API 调用成本</p>
</li>
</ol>
<h2 id="常见问题">常见问题</h2>
<p>建议设置合理的超时时间，并实现重试机制：</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#268bd2">@Retryable</span>(
</span></span><span style="display:flex;"><span>    value <span style="color:#719e07">=</span> {TimeoutException.class},
</span></span><span style="display:flex;"><span>    maxAttempts <span style="color:#719e07">=</span> 3,
</span></span><span style="display:flex;"><span>    backoff <span style="color:#719e07">=</span> <span style="color:#268bd2">@Backoff</span>(delay <span style="color:#719e07">=</span> 1000)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">public</span> String <span style="color:#268bd2">chatWithRetry</span>(String message) {
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">return</span> chatService.chat(message);
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="总结">总结</h2>
<p>通过本文的介绍，我们学习了如何在 SpringBoot 项目中集成 LangChain4J，实现了一个基础的 AI 聊天应用。主要包括：</p>
<ol>
<li>基础配置和依赖管理</li>
<li>核心功能实现</li>
<li>高级特性使用</li>
<li>性能优化和监控</li>
<li>安全性考虑</li>
</ol>
<p>在实际开发中，建议根据具体需求选择合适的功能特性，同时注意安全性、性能和成本控制等方面的考虑。</p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://docs.langchain4j.dev">LangChain4j 官方文档</a></li>
<li><a href="https://spring.io/projects/spring-boot">SpringBoot 官方文档</a></li>
<li><a href="https://platform.openai.com/docs/api-reference">OpenAI API 文档</a></li>
</ul>]]></content:encoded>
    </item>
    
    <item>
      <title>SpringBoot &#43; LangChain4j 实现智能 AI Agent</title>
      <link>https://blog.kylegeeks.com/posts/2025/01/springboot-langchain4j-agent/</link>
      <pubDate>Mon, 20 Jan 2025 10:00:00 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2025/01/springboot-langchain4j-agent/</guid>
      <description>详细介绍如何使用 SpringBoot 和 LangChain4j 实现一个智能 AI Agent</description>
      <content:encoded><![CDATA[<h2 id="什么是-ai-agent">什么是 AI Agent？</h2>
<p>AI Agent 是一个能够自主决策和执行任务的智能代理。它可以：</p>
<ul>
<li>理解用户意图</li>
<li>规划任务步骤</li>
<li>调用工具完成任务</li>
<li>处理异常情况</li>
<li>持续优化决策</li>
</ul>
<h2 id="系统架构">系统架构</h2>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
    A[用户请求] --&gt; B[Agent Controller]
    B --&gt; C[Agent Service]
    C --&gt; D[任务规划器]
    C --&gt; E[工具注册中心]
    D --&gt; F[OpenAI]
    E --&gt; G[计算器]
    E --&gt; H[搜索引擎]
    E --&gt; I[天气查询]
    F --&gt; C
    G --&gt; C
    H --&gt; C
    I --&gt; C
</code></pre><h2 id="项目实现">项目实现</h2>
<h3 id="1-maven-依赖配置">1. Maven 依赖配置</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#268bd2">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75">&lt;!-- SpringBoot --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75">&lt;!-- LangChain4j --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;groupId&gt;</span>dev.langchain4j<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;artifactId&gt;</span>langchain4j<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;version&gt;</span>0.27.1<span style="color:#268bd2">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75">&lt;!-- LangChain4j Agent --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;groupId&gt;</span>dev.langchain4j<span style="color:#268bd2">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;artifactId&gt;</span>langchain4j-agent<span style="color:#268bd2">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&lt;version&gt;</span>0.27.1<span style="color:#268bd2">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-工具实现">2. 工具实现</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#268bd2">@Tool</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">Calculator</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@ToolFunction</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> <span style="color:#dc322f">double</span> <span style="color:#268bd2">add</span>(<span style="color:#dc322f">double</span> a, <span style="color:#dc322f">double</span> b) {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">return</span> a <span style="color:#719e07">+</span> b;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@ToolFunction</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> <span style="color:#dc322f">double</span> <span style="color:#268bd2">multiply</span>(<span style="color:#dc322f">double</span> a, <span style="color:#dc322f">double</span> b) {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">return</span> a <span style="color:#719e07">*</span> b;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">@Tool</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">WeatherService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@ToolFunction</span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> String <span style="color:#268bd2">getWeather</span>(String city) {
</span></span><span style="display:flex;"><span>        <span style="color:#586e75">// 调用天气 API</span>
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">return</span> <span style="color:#2aa198">&#34;晴天，温度 25℃&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-agent-服务实现">3. Agent 服务实现</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#268bd2">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">AIAgentService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> ChatLanguageModel chatModel;
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> ToolRegistry toolRegistry;
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> Agent agent;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">AIAgentService</span>(ChatLanguageModel chatModel) {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">this</span>.chatModel <span style="color:#719e07">=</span> chatModel;
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">this</span>.toolRegistry <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ToolRegistry();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#586e75">// 注册工具</span>
</span></span><span style="display:flex;"><span>        toolRegistry.registerTool(<span style="color:#719e07">new</span> Calculator());
</span></span><span style="display:flex;"><span>        toolRegistry.registerTool(<span style="color:#719e07">new</span> WeatherService());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#586e75">// 创建 Agent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">this</span>.agent <span style="color:#719e07">=</span> Agent.builder()
</span></span><span style="display:flex;"><span>            .chatLanguageModel(chatModel)
</span></span><span style="display:flex;"><span>            .toolRegistry(toolRegistry)
</span></span><span style="display:flex;"><span>            .build();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> String <span style="color:#268bd2">process</span>(String userInput) {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">try</span> {
</span></span><span style="display:flex;"><span>            AgentResponse response <span style="color:#719e07">=</span> agent.process(userInput);
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">return</span> response.getOutput();
</span></span><span style="display:flex;"><span>        } <span style="color:#719e07">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            log.error(<span style="color:#2aa198">&#34;Agent 处理失败&#34;</span>, e);
</span></span><span style="display:flex;"><span>            <span style="color:#719e07">return</span> <span style="color:#2aa198">&#34;抱歉，我现在无法处理这个请求&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-controller-实现">4. Controller 实现</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#268bd2">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">@RequestMapping</span>(<span style="color:#2aa198">&#34;/api/agent&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">AgentController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> AIAgentService agentService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">AgentController</span>(AIAgentService agentService) {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">this</span>.agentService <span style="color:#719e07">=</span> agentService;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@PostMapping</span>(<span style="color:#2aa198">&#34;/chat&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> ResponseEntity<span style="color:#719e07">&lt;</span>String<span style="color:#719e07">&gt;</span> <span style="color:#268bd2">chat</span>(<span style="color:#268bd2">@RequestBody</span> String message) {
</span></span><span style="display:flex;"><span>        String response <span style="color:#719e07">=</span> agentService.process(message);
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">return</span> ResponseEntity.ok(response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="agent-工作流程">Agent 工作流程</h2>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">sequenceDiagram
participant User as 用户
participant Agent as AI Agent
participant LLM as 大语言模型
participant Tools as 工具集

    User-&gt;&gt;Agent: 发送请求
    Agent-&gt;&gt;LLM: 分析用户意图
    LLM--&gt;&gt;Agent: 返回任务分解
    loop 任务执行
        Agent-&gt;&gt;Tools: 调用相关工具
        Tools--&gt;&gt;Agent: 返回工具结果
        Agent-&gt;&gt;LLM: 结果评估
        LLM--&gt;&gt;Agent: 下一步计划
    end
    Agent-&gt;&gt;User: 返回最终结果
</code></pre><h2 id="示例场景">示例场景</h2>
<h3 id="1-数学计算场景">1. 数学计算场景</h3>
<p>用户输入：</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>请帮我计算：(23 + 45) * 2 是多少？
</span></span></code></pre></td></tr></table>
</div>
</div><p>Agent 处理流程：</p>
<ol>
<li>分析出需要使用计算器工具</li>
<li>拆分为加法和乘法两步</li>
<li>调用计算器完成计算</li>
<li>返回结果</li>
</ol>
<h3 id="2-天气查询场景">2. 天气查询场景</h3>
<p>用户输入：</p>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>北京今天天气怎么样？需要带伞吗？
</span></span></code></pre></td></tr></table>
</div>
</div><p>Agent 处理流程：</p>
<ol>
<li>识别需要查询天气</li>
<li>调用天气服务获取数据</li>
<li>分析是否需要带伞</li>
<li>给出建议</li>
</ol>
<h2 id="最佳实践">最佳实践</h2>
<h3 id="1-错误处理">1. 错误处理</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">AgentException</span> <span style="color:#268bd2">extends</span> RuntimeException {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">AgentException</span>(String message) {
</span></span><span style="display:flex;"><span>        <span style="color:#268bd2">super</span>(message);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">@ControllerAdvice</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">AgentExceptionHandler</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">@ExceptionHandler</span>(AgentException.class)
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> ResponseEntity<span style="color:#719e07">&lt;</span>String<span style="color:#719e07">&gt;</span> <span style="color:#268bd2">handleAgentException</span>(AgentException e) {
</span></span><span style="display:flex;"><span>        <span style="color:#719e07">return</span> ResponseEntity
</span></span><span style="display:flex;"><span>            .status(HttpStatus.INTERNAL_SERVER_ERROR)
</span></span><span style="display:flex;"><span>            .body(e.getMessage());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-性能优化">2. 性能优化</h3>
<ol>
<li>使用工具结果缓存</li>
<li>实现并发任务处理</li>
<li>设置合理的超时时间</li>
</ol>
<h3 id="3-监控指标">3. 监控指标</h3>
<div class="highlight"><div style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#268bd2">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">AgentMetricsService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">private</span> <span style="color:#268bd2">final</span> MeterRegistry registry;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> <span style="color:#dc322f">void</span> <span style="color:#268bd2">recordToolUsage</span>(String toolName) {
</span></span><span style="display:flex;"><span>        registry.counter(<span style="color:#2aa198">&#34;agent.tool.usage&#34;</span>, <span style="color:#2aa198">&#34;tool&#34;</span>, toolName).increment();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">public</span> <span style="color:#dc322f">void</span> <span style="color:#268bd2">recordProcessingTime</span>(<span style="color:#dc322f">long</span> milliseconds) {
</span></span><span style="display:flex;"><span>        registry.timer(<span style="color:#2aa198">&#34;agent.processing.time&#34;</span>).record(milliseconds, TimeUnit.MILLISECONDS);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安全考虑">安全考虑</h2>
<ol>
<li>工具调用权限控制</li>
<li>用户输入验证</li>
<li>敏感信息保护</li>
<li>调用频率限制</li>
</ol>
<h2 id="总结">总结</h2>
<p>通过 SpringBoot + LangChain4j 实现的 AI Agent 具有以下优势：</p>
<ol>
<li>架构清晰，易于扩展</li>
<li>工具集成灵活</li>
<li>错误处理完善</li>
<li>性能监控到位</li>
</ol>
<p>在实际应用中，可以根据具体需求：</p>
<ul>
<li>添加更多工具</li>
<li>优化决策逻辑</li>
<li>增强安全机制</li>
<li>提升用户体验</li>
</ul>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://docs.langchain4j.dev/agent">LangChain4j Agent 文档</a></li>
<li><a href="https://spring.io/projects/spring-boot">SpringBoot 官方文档</a></li>
<li><a href="https://platform.openai.com/docs/api-reference">OpenAI API 文档</a></li>
</ul>]]></content:encoded>
    </item>
    
    <item>
      <title>域名购买到博客配置的过程记录</title>
      <link>https://blog.kylegeeks.com/posts/2024/09/configure-domain/</link>
      <pubDate>Sun, 22 Sep 2024 15:53:03 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2024/09/configure-domain/</guid>
      <description>&lt;p&gt;这篇记录详细描述了我从购买域名到配置博客的全过程, 包括选择域名, 注册步骤, DNS 设置及博客平台配置等关键环节.
旨在帮助读者了解每一步的具体操作, 为他们的博客创建提供参考.
这里感谢下赛博佛祖: &lt;code&gt;Cloudfalre&lt;/code&gt;&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>这篇记录详细描述了我从购买域名到配置博客的全过程, 包括选择域名, 注册步骤, DNS 设置及博客平台配置等关键环节.
旨在帮助读者了解每一步的具体操作, 为他们的博客创建提供参考.
这里感谢下赛博佛祖: <code>Cloudfalre</code></p>
<h2 id="选择方案">选择方案</h2>
<p>因为在国内域名要备案, 秉承着 <code>INTP</code> 的懒人思想, 能避免麻烦就避免选择了在国外注册域名, 当然也想着为以后能做点海外的产品或者网站先铺铺路.
通过 <code>Google</code> 和询问了群里的大佬, 一般都是在哪里购买域名, 推荐是</p>
<ul>
<li><a href="https://www.cloudflare.com/">Cloudflare</a></li>
<li><a href="https://www.namecheap.com/">namecheap</a></li>
</ul>
<p>对比了下 2 个价格, <code>namecheap</code> 会便宜些, 所以就通过 <code>namecheap</code> 注册了</p>
<h2 id="选择域名">选择域名</h2>
<p>我一直以来用的 AKA 或者网名都是: L_MaFia , 根据 lmafia 搜索,哪个便宜买哪个, 比如 <code>.info</code>, <code>.xyz</code>, <code>.life</code> 啥的.
<code>.info</code> 一年只需要 $2.4 左右, 注意购买的时候最好关闭自动续费,一般续费价格就不划算了,我也当做是练手,可能不一定会使用超过一年时间.</p>
<h2 id="支付方式">支付方式</h2>
<p><code>namecheap</code> 支持使用 <code>Visa</code>, <code>PayPal</code> 一些常用的国外支付方式, 这也应该难倒了不少网友了,如果我没有 <code>Visa</code> 卡, 全币卡咋办？
其实,<code>PayPal</code> 是可以关联咱们的银联的储蓄卡的,这次购买一年的域名的花费总购不在 <strong>27RMB</strong>.</p>
<p>我选择了一张基本不使用的建设银行的储蓄卡,但是在付费扣款时一直出现失败</p>
<p>询问了群里的大佬,应该是有踩坑的经验: 国内一些银联卡可能会无法支付,他是用招商银行的卡支付的</p>
<p>我记得我本科的时候,使用 <code>PayPal</code> 购买过 <code>DigitalOcean</code> 的服务器时用过工行卡,想着还是听大佬的先试试看,为了保险起见的话,打不了支付成功后再解绑即可.</p>
<p>实测下来:</p>
<ul>
<li>建设银行-无法支付</li>
<li>招商银行-成功支付</li>
</ul>
<h2 id="让域名指向博客">让域名指向博客</h2>
<p>我的博客是用 <code>Hugo</code> 搭建的纯静态的网站,白嫖了 <code>Vercel</code> 和 <code>GithPage</code>, 体验下来 <code>Vercel</code> 的访问速度会好些,当然我后续我可能会尝试白嫖 <code>Cloudflare Pages</code></p>
<h3 id="cloudfalre-添加域名">Cloudfalre 添加域名</h3>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2024/09/de60df2613b1133f7364f412109858ab.png" alt="cf-domain-add"  /></p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2024/09/de60df2613b1133f7364f412109858ab.png" alt="cf-domain-add"  /></p>
<h3 id="cloudflare-的免费-ssl">Cloudflare 的免费 SSL</h3>
<p>想用 <code>HTTPS</code> 就避免不了需要使用 <code>SSL</code>,不仅因为安全考虑,还有如果需要一些域名解析指向应用服务平台,平台也会一定的安全要求 ,<code>Cloudflare</code> 免费提供了 <code>SSL</code> 够我们开发者的博客内容使用了</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2024/09/96c64f4a47229bc5b7bfb92f89c51031.png" alt="cf-domain-ssl"  /></p>
<p>一定要选择 <code>Strict</code> , 不然 <code>Vercel</code> 是不会给是指向过去的</p>
<h3 id="cloudfalre-提供-dns-服务">Cloudfalre 提供 DNS 服务</h3>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2024/09/601c619ea66d25bec14f5bb9eed3b574.png" alt="cf-domain-dns"  /></p>
<h3 id="namecheap-配置-dns">Namecheap 配置 DNS</h3>
<p><code>Namecheap</code> 提供也 <code>DNS</code> 了,但是因为我们需要 <strong>白嫖</strong> <code>SSL</code>
所以需要修改下 <code>DNS</code> 服务列表
<code>Namecheap</code> 提供的教程:</p>
<ul>
<li><a href="https://www.namecheap.com/support/knowledgebase/article.aspx/9607/2210/how-to-set-up-dns-records-for-your-domain-in-a-cloudflare-account/">How to set up DNS records for your domain in a Cloudflare account</a></li>
</ul>
<p>看其中的第三和第四步,大概也就了解了</p>
<p>配置好这个之后,可以说我们的域名就可以交给 <code>Cloudfalre</code> 来 「管理」 了</p>
<h3 id="cloudfalre-添加-dns-record">Cloudfalre 添加 DNS Record</h3>
<p>这一步就是给用户访问域名的时候, 需要浏览到我们的具体网页地址上
这里我添加了一个 <code>CNAME</code> 规则</p>
<ul>
<li><code>CNAME</code>: 域名解析为另外一个域名</li>
</ul>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2024/09/96c64f4a47229bc5b7bfb92f89c51031.png" alt="cf-domain-dns-cname"  /></p>
<p>当我输入浏览器输入: <code>blog.kylegeeks.com</code> 时, 会解析到目标地址: <code>Vercel</code> 的博客域名</p>
<h3 id="vercel-域名添加配置"><code>Vercel</code> 域名添加配置</h3>
<p>最后一步就是在 <code>Vercel</code> 给我们博客项目配置域名
我们一直配置好 Cloudfalre 到 <code>Vercel</code> 的单向的配置了
我估计是 <code>Vercel</code> 因为安全原因,还需要配置这个域名并会自动验证
验证可用会有 2 个 ✅ 出现</p>
<p>
  <img loading="lazy" src="https://image-s3.kylegeeks.com/data/2024/09/c897ac0953232354a4cc6862a95228c7.png" alt="vercel-domain-add"  /></p>
<h2 id="完成配置">完成配置</h2>
<p>接下来, 让我们通过域名访问下该站点吧:</p>
<p><del><a href="https://blog.lmafia.info">https://blog.lmafia.info</a></del></p>
<blockquote>
<p>(2025 年域名已升级)</p>
</blockquote>
<p><a href="https://blog.kylegeeks.com">https://blog.kylegeeks.com</a></p>
<p>成功访问!</p>
<p>恭喜,我们已经完成了给我们的博客配置一个属于自己的域名啦!</p>]]></content:encoded>
    </item>
    
    <item>
      <title>第一篇博客</title>
      <link>https://blog.kylegeeks.com/posts/2023/09/first-page/</link>
      <pubDate>Fri, 29 Sep 2023 16:46:16 +0800</pubDate>
      
      <guid>https://blog.kylegeeks.com/posts/2023/09/first-page/</guid>
      <description>&lt;p&gt;我的第一篇想要输出的博客内容应该是在大四的时候，那时候应该 &lt;code&gt;COVID-19&lt;/code&gt;，都困在家里完成毕业设计和毕业论文。&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>我的第一篇想要输出的博客内容应该是在大四的时候，那时候应该 <code>COVID-19</code>，都困在家里完成毕业设计和毕业论文。</p>
<h2 id="为什么创建博客">为什么创建博客</h2>
<p>主要是因为我没有博客, 所以我想搭一个, 哈哈哈.</p>
<p>我的第一篇想要输出的博客内容应该是在大四的时候，那时候应该 <code>COVID-19</code>，都困在家里完成毕业设计和毕业论文。</p>
<p>那会的毕业设计算是接了一个坑，是一个 ROS+SLAM 的机器人，老师给了我一个没有任何中文资料的激光雷达，我又去买了一个刚出树莓派 4B 来做系统。
当时的中文资料比较有限，只能靠着自己摸索，和翻墙找资料，最后一点一点填出来。我当时想着既然没有啥中文资料，那不如自己写一个，就在 <code>CSDN</code> 上发了一篇关于在树莓派 4B 搭建 ROS 的博客。</p>
<p>后来毕业之后，就转岗到 <code>Java</code> 开发了，完全从零基础就要上工的过程真的很痛苦，因为我也不是科班的，当时就花钱买了一个网上的培训课程，一心想着学成之后离开那家公司。</p>
<p>当时上课做的笔记，自己总结一下就放到了 <code>CSDN</code> 上，主要是一种炫耀的心情吧，我自己认为最重要的原因就是想放在简历上，可以让面试官觉得自己稍微有点技术追求之类的。
现在的 <code>CSDN</code> 已经在国内的技术圈子里开始臭名昭著了，所以我也不太愿意在上面发东西了。所以后面工作和业余的记录就通过 <code>Typroa</code> 写完上传到 <code>Github</code> 上。</p>
<p>后来就一直用 <code>markdown</code> 记录，不过创建目录、文件应该放在什么位置，对我来说需要耗费心力的事情，我又是一个又懒又拖延的人，这样会让我不愿意去记录东西。后来在网上就刷到了双链笔记的相关文章，非常火的是 <code>notion</code> ，主要我觉得因为它对网络有一定要求，所以不是很喜欢。我还是更希望自己用一个纯本地的文本编辑: <code>obsidian</code> 和 <code>logseq</code>，其实都能满足我的需求了，最后是因为 UI ，选了我自己认为比较轻便的 <code>logseq</code> 。</p>
<p>就这样，我就在 2022 年底，我过上了几乎每天都在记录的日子，记录自己的想法，自己的读书笔记，记录看技术文章或技术视频，记录看到的推文&hellip;</p>
<p><img loading="lazy" src="/posts/2023/09/first-page/2023-logseq-hot-01.png" type="" alt="1"  /></p>
<p><img loading="lazy" src="/posts/2023/09/first-page/2023-logseq-hot-02.png" type="" alt="2"  /></p>
<p><img loading="lazy" src="/posts/2023/09/first-page/2023-logseq-hot-03.png" type="" alt="3"  /></p>
<p>随着记录不断增多，让我觉得我可能又只是在做一个小松鼠而已，自己的思考和总结并没有很大的提升。我一昧的记录，对我吸收知识帮助不是特别大。
最近因为尝试把学习练手 <code>Vue3</code> 的静态网站搭建在 <code>Gitub Pages</code> 上，发现并不难。所以想自己尝试把自己的博客搭建起来，通过写博文的方式，让自己有动力去把日常记录的内容总结一下。</p>
<h2 id="技术选型">技术选型</h2>
<h3 id="开源博客">开源博客</h3>
<ol>
<li><a href="https://hexo.io/">Hexo</a></li>
<li><a href="https://gohugo.io/">Hugo</a></li>
<li><a href="https://vuepress.vuejs.org/">VuePress</a></li>
<li><a href="https://vitepress.dev/">VitePress</a></li>
</ol>
<p>主要是想体验一下不同的技术，所以选择了基于 <code>go</code> 的 <code>hugo</code></p>
<h3 id="服务器">服务器</h3>
<p>直接白嫖 <a href="https://pages.github.com/">GitHub Pages</a></p>
<h3 id="编辑器">编辑器</h3>
<p><code>Visual Studio Code</code></p>
<p>它真的非常适合，既能装 <code>markdown</code> 插件，又能作为 <code>Git</code> 的可视化，还能有 <code>terminal</code> 来方便我们敲命令。</p>
<h2 id="需要会什么">需要会什么</h2>
<p>折腾技术的最不怕不会任何东西， 应该都会有一颗保持好奇的心， 学习应该算是一件比较简单的事情啦， 又加上搜索引擎， 甚至用上如同 <code>ChatGPT</code> 这种的 <code>AI</code> 工具， 还是能解决我们大部分学习需求的吧。</p>
<ol>
<li><code>Git</code>: 毕竟要用到 <code>Github</code>, 而且有一定的版本管理还能方便咱们回溯内容</li>
<li><code>Shell</code> 命令: 安装</li>
</ol>]]></content:encoded>
    </item>
    
  </channel>
</rss>
